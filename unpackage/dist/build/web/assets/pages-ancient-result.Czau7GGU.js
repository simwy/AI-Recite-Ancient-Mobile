import{j as t,C as a,D as e,c as s,w as l,x as i,f as c,o as n,a as r,d,t as o,m as f,p as u,F as h,e as g,g as _,y as x,v as y}from"./index-mx_jV9ub.js";import{_ as m}from"./_plugin-vue_export-helper.BCo6x5W8.js";function p(t){return t.replace(/[，。、；：？！""''（）《》\s\n\r,.;:?!'"()\[\]{}]/g,"")}function D(t,a){const e=p(t),s=p(a),l=function(t,a){const e=t.length,s=a.length,l=Array.from({length:e+1},(()=>new Array(s+1).fill(0)));for(let i=1;i<=e;i++)for(let e=1;e<=s;e++)t[i-1]===a[e-1]?l[i][e]=l[i-1][e-1]+1:l[i][e]=Math.max(l[i-1][e],l[i][e-1]);return l}(e,s),i=[];let c=e.length,n=s.length;const r=[];for(;c>0&&n>0;)e[c-1]===s[n-1]?(r.unshift({i:c-1,j:n-1,match:!0}),c--,n--):l[c-1][n]>=l[c][n-1]?c--:n--;let d=0;for(let o=0;o<e.length;o++)d<r.length&&r[d].i===o?(i.push({char:e[o],status:"correct"}),d++):i.push({char:e[o],status:"missing"});return i}const v=m({data:()=>({id:"",textData:{},recognizedText:"",hintCount:0,diffResult:[],accuracy:0,saved:!1}),onLoad(t){this.id=t.id;const a=i(),e=a.globalData&&a.globalData.reciteResult;e&&(this.textData=e.textData,this.recognizedText=e.recognizedText,this.hintCount=e.hintCount),this.doDiff(),this.saveRecord()},methods:{doDiff(){this.textData.content&&(this.diffResult=D(this.textData.content,this.recognizedText),this.accuracy=function(t){if(!t||0===t.length)return 0;const a=t.filter((t=>"correct"===t.status)).length;return Math.round(a/t.length*100)}(this.diffResult))},async saveRecord(){if(!this.saved)try{await t.callFunction({name:"recite-record",data:{action:"save",data:{text_id:this.id,text_title:this.textData.title,hint_count:this.hintCount,recognized_text:this.recognizedText,diff_result:this.diffResult,accuracy:this.accuracy}}}),this.saved=!0}catch(a){console.error("保存记录失败:",a)}},goReciteAgain(){a({url:`/pages/ancient/recite?id=${this.id}`})},goHistory(){e({url:"/pages/ancient/history"})}}},[["render",function(t,a,e,i,m,p){const D=_,v=c,z=x;return n(),s(v,{class:"container"},{default:l((()=>[r(v,{class:"header"},{default:l((()=>[r(D,{class:"title"},{default:l((()=>[d(o(m.textData.title),1)])),_:1}),r(v,{class:"stats"},{default:l((()=>[r(v,{class:"stat-item"},{default:l((()=>[r(D,{class:"stat-value"},{default:l((()=>[d(o(m.accuracy)+"%",1)])),_:1}),r(D,{class:"stat-label"},{default:l((()=>[d("正确率")])),_:1})])),_:1}),r(v,{class:"stat-item"},{default:l((()=>[r(D,{class:"stat-value"},{default:l((()=>[d(o(m.hintCount),1)])),_:1}),r(D,{class:"stat-label"},{default:l((()=>[d("提示次数")])),_:1})])),_:1})])),_:1})])),_:1}),r(v,{class:"diff-area"},{default:l((()=>[r(v,{class:"diff-label"},{default:l((()=>[d("对比结果：")])),_:1}),r(v,{class:"diff-content"},{default:l((()=>[(n(!0),f(h,null,u(m.diffResult,((t,a)=>(n(),s(D,{key:a,class:y(["diff-char","diff-"+t.status])},{default:l((()=>[d(o(t.char),1)])),_:2},1032,["class"])))),128))])),_:1})])),_:1}),r(v,{class:"legend"},{default:l((()=>[r(D,{class:"legend-correct"},{default:l((()=>[d("● 正确")])),_:1}),r(D,{class:"legend-missing"},{default:l((()=>[d("● 遗漏/错误")])),_:1})])),_:1}),m.recognizedText?(n(),s(v,{key:0,class:"recognized-area"},{default:l((()=>[r(v,{class:"diff-label"},{default:l((()=>[d("识别文字：")])),_:1}),r(D,{class:"recognized-text"},{default:l((()=>[d(o(m.recognizedText),1)])),_:1})])),_:1})):g("",!0),r(v,{class:"action-area"},{default:l((()=>[r(z,{type:"primary",class:"btn",onClick:p.goReciteAgain},{default:l((()=>[d(" 再背一次 ")])),_:1},8,["onClick"]),r(z,{class:"btn btn-secondary",onClick:p.goHistory},{default:l((()=>[d(" 查看历史 ")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-dd74609a"]]);export{v as default};
