import{s as t,j as e,k as a,q as s,c as l,w as i,f as d,o as n,m as o,p as c,F as r,a as f,d as u,e as h,g,t as _,u as m,v as p}from"./index-mx_jV9ub.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=y({data:()=>({list:[],loading:!1,page:1,total:0,expandedId:"",deletingId:""}),onShow(){this.page=1,this.loadData()},onPullDownRefresh(){this.page=1,this.loadData().then((()=>t()))},onReachBottom(){this.list.length<this.total&&(this.page++,this.loadData(!0))},methods:{async loadData(t=!1){this.loading=!0;try{const a=await e.callFunction({name:"recite-record",data:{action:"list",data:{page:this.page,pageSize:20}}}),s=a&&a.result||{};if(0!==s.code||!s.data)throw new Error(s.msg||"加载失败");const{list:l,total:i}=s.data;this.list=t?[...this.list,...l]:l,this.total=i}catch(s){a({title:s&&s.message||"加载失败",icon:"none"})}finally{this.loading=!1}},toggleDetail(t){this.expandedId=this.expandedId===t?"":t},async confirmDelete(t){if(!t||!t._id||this.deletingId)return;(await new Promise((t=>{s({title:"删除记录",content:"确定删除这条背诵记录吗？删除后不可恢复。",confirmText:"删除",confirmColor:"#f5222d",success:t,fail:()=>t({confirm:!1})})}))).confirm&&this.deleteRecord(t._id)},async deleteRecord(t){this.deletingId=t;try{const s=await e.callFunction({name:"recite-record",data:{action:"delete",data:{id:t}}}),l=s&&s.result||{};if(0!==l.code)throw new Error(l.msg||"删除失败");this.list=this.list.filter((e=>e._id!==t)),this.total=Math.max(0,this.total-1),this.expandedId===t&&(this.expandedId=""),a({title:"删除成功",icon:"success"})}catch(s){a({title:s&&s.message||"删除失败",icon:"none"})}finally{this.deletingId=""}},formatTime(t){if(!t)return"";const e=new Date(t),a=t=>String(t).padStart(2,"0");return`${e.getFullYear()}-${a(e.getMonth()+1)}-${a(e.getDate())} ${a(e.getHours())}:${a(e.getMinutes())}`}}},[["render",function(t,e,a,s,y,x){const k=g,w=d;return n(),l(w,{class:"container"},{default:i((()=>[y.list.length>0?(n(),l(w,{key:0,class:"list"},{default:i((()=>[(n(!0),o(r,null,c(y.list,(t=>(n(),l(w,{class:"list-item",key:t._id,onClick:e=>x.toggleDetail(t._id)},{default:i((()=>[f(w,{class:"item-header"},{default:i((()=>[f(k,{class:"item-title"},{default:i((()=>[u(_(t.text_title),1)])),_:2},1024),f(w,{class:"item-right"},{default:i((()=>[f(k,{class:"item-accuracy"},{default:i((()=>[u(_(t.accuracy||0)+"%",1)])),_:2},1024),f(k,{class:"item-delete",onClick:m((e=>x.confirmDelete(t)),["stop"])},{default:i((()=>[u("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),f(w,{class:"item-meta"},{default:i((()=>[f(k,null,{default:i((()=>[u("提示 "+_(t.hint_count)+" 次",1)])),_:2},1024),f(k,{class:"item-time"},{default:i((()=>[u(_(x.formatTime(t.created_at)),1)])),_:2},1024)])),_:2},1024),y.expandedId===t._id?(n(),l(w,{key:0,class:"item-detail"},{default:i((()=>[f(w,{class:"diff-content"},{default:i((()=>[(n(!0),o(r,null,c(t.diff_result||[],((t,e)=>(n(),l(k,{key:e,class:p(["diff-char","diff-"+t.status])},{default:i((()=>[u(_(t.char),1)])),_:2},1032,["class"])))),128))])),_:2},1024),t.recognized_text?(n(),l(w,{key:0,class:"recognized"},{default:i((()=>[f(k,{class:"recognized-label"},{default:i((()=>[u("识别文字：")])),_:1}),f(k,{class:"recognized-text"},{default:i((()=>[u(_(t.recognized_text),1)])),_:2},1024)])),_:2},1024)):h("",!0)])),_:2},1024)):h("",!0)])),_:2},1032,["onClick"])))),128))])),_:1})):y.loading?h("",!0):(n(),l(w,{key:1,class:"empty"},{default:i((()=>[f(k,null,{default:i((()=>[u("暂无背诵记录")])),_:1})])),_:1})),y.loading?(n(),l(w,{key:2,class:"loading"},{default:i((()=>[f(k,null,{default:i((()=>[u("加载中...")])),_:1})])),_:1})):h("",!0)])),_:1})}],["__scopeId","data-v-dee1b6ae"]]);export{x as default};
