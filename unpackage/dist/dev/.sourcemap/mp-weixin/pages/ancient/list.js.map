{"version":3,"file":"list.js","sources":["pages/ancient/list.vue","pages/ancient/list.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <view class=\"search-bar\">\r\n      <uni-search-bar\r\n        v-model=\"keyword\"\r\n        placeholder=\"搜索古文标题或内容\"\r\n        @confirm=\"onSearch\"\r\n        @clear=\"onClear\"\r\n        @input=\"onInput\"\r\n      />\r\n    </view>\r\n\r\n    <view class=\"list\" v-if=\"list.length > 0\">\r\n      <view\r\n        class=\"list-item\"\r\n        v-for=\"item in list\"\r\n        :key=\"item._id\"\r\n        @click=\"goDetail(item._id)\"\r\n      >\r\n        <view class=\"item-title\">{{ item.title }}</view>\r\n        <view class=\"item-meta\">\r\n          <text class=\"item-author\">{{ item.dynasty }} · {{ item.author }}</text>\r\n        </view>\r\n        <view class=\"item-preview\">{{ getPreview(item.content) }}</view>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"empty\" v-else-if=\"!loading\">\r\n      <text>{{ keyword ? '未找到相关古文' : '暂无古文数据' }}</text>\r\n    </view>\r\n\r\n    <view class=\"loading\" v-if=\"loading\">\r\n      <text>加载中...</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      keyword: '',\r\n      list: [],\r\n      loading: false,\r\n      page: 1,\r\n      total: 0,\r\n      timer: null\r\n    }\r\n  },\r\n  onLoad() {\r\n    this.loadData()\r\n  },\r\n  onPullDownRefresh() {\r\n    this.page = 1\r\n    this.loadData().then(() => uni.stopPullDownRefresh())\r\n  },\r\n  onReachBottom() {\r\n    if (this.list.length < this.total) {\r\n      this.page++\r\n      this.loadData(true)\r\n    }\r\n  },\r\n  methods: {\r\n    onInput(e) {\r\n      clearTimeout(this.timer)\r\n      this.timer = setTimeout(() => {\r\n        this.page = 1\r\n        this.loadData()\r\n      }, 300)\r\n    },\r\n    onSearch() {\r\n      this.page = 1\r\n      this.loadData()\r\n    },\r\n    onClear() {\r\n      this.keyword = ''\r\n      this.page = 1\r\n      this.loadData()\r\n    },\r\n    async loadData(append = false) {\r\n      this.loading = true\r\n      try {\r\n        const res = await uniCloud.callFunction({\r\n          name: 'ancient-search',\r\n          data: {\r\n            keyword: this.keyword,\r\n            page: this.page,\r\n            pageSize: 20\r\n          }\r\n        })\r\n        const { list, total } = res.result.data\r\n        this.list = append ? [...this.list, ...list] : list\r\n        this.total = total\r\n      } catch (e) {\r\n        uni.showToast({ title: '加载失败', icon: 'none' })\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    getPreview(content) {\r\n      return content.length > 30 ? content.slice(0, 30) + '...' : content\r\n    },\r\n    goDetail(id) {\r\n      uni.navigateTo({ url: `/pages/ancient/detail?id=${id}` })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  padding: 20rpx;\r\n}\r\n.search-bar {\r\n  margin-bottom: 20rpx;\r\n}\r\n.list-item {\r\n  padding: 24rpx;\r\n  margin-bottom: 16rpx;\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.06);\r\n}\r\n.item-title {\r\n  font-size: 34rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 8rpx;\r\n}\r\n.item-meta {\r\n  margin-bottom: 12rpx;\r\n}\r\n.item-author {\r\n  font-size: 26rpx;\r\n  color: #888;\r\n}\r\n.item-preview {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  line-height: 1.6;\r\n}\r\n.empty, .loading {\r\n  text-align: center;\r\n  padding: 100rpx 0;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from '/Users/chensm/Desktop/my-source/github.com/simwy/AI-Recite-Ancient-Mobile/pages/ancient/list.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":";;AAsCA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,SAAS;AAAA,MACT,MAAM,CAAE;AAAA,MACR,SAAS;AAAA,MACT,MAAM;AAAA,MACN,OAAO;AAAA,MACP,OAAO;AAAA,IACT;AAAA,EACD;AAAA,EACD,SAAS;AACP,SAAK,SAAS;AAAA,EACf;AAAA,EACD,oBAAoB;AAClB,SAAK,OAAO;AACZ,SAAK,SAAQ,EAAG,KAAK,MAAMA,cAAG,MAAC,oBAAmB,CAAE;AAAA,EACrD;AAAA,EACD,gBAAgB;AACd,QAAI,KAAK,KAAK,SAAS,KAAK,OAAO;AACjC,WAAK;AACL,WAAK,SAAS,IAAI;AAAA,IACpB;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,QAAQ,GAAG;AACT,mBAAa,KAAK,KAAK;AACvB,WAAK,QAAQ,WAAW,MAAM;AAC5B,aAAK,OAAO;AACZ,aAAK,SAAS;AAAA,MACf,GAAE,GAAG;AAAA,IACP;AAAA,IACD,WAAW;AACT,WAAK,OAAO;AACZ,WAAK,SAAS;AAAA,IACf;AAAA,IACD,UAAU;AACR,WAAK,UAAU;AACf,WAAK,OAAO;AACZ,WAAK,SAAS;AAAA,IACf;AAAA,IACD,MAAM,SAAS,SAAS,OAAO;AAC7B,WAAK,UAAU;AACf,UAAI;AACF,cAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACtC,MAAM;AAAA,UACN,MAAM;AAAA,YACJ,SAAS,KAAK;AAAA,YACd,MAAM,KAAK;AAAA,YACX,UAAU;AAAA,UACZ;AAAA,SACD;AACD,cAAM,EAAE,MAAM,MAAQ,IAAE,IAAI,OAAO;AACnC,aAAK,OAAO,SAAS,CAAC,GAAG,KAAK,MAAM,GAAG,IAAI,IAAI;AAC/C,aAAK,QAAQ;AAAA,MACf,SAAS,GAAG;AACVD,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,MAC/C,UAAU;AACR,aAAK,UAAU;AAAA,MACjB;AAAA,IACD;AAAA,IACD,WAAW,SAAS;AAClB,aAAO,QAAQ,SAAS,KAAK,QAAQ,MAAM,GAAG,EAAE,IAAI,QAAQ;AAAA,IAC7D;AAAA,IACD,SAAS,IAAI;AACXA,oBAAG,MAAC,WAAW,EAAE,KAAK,4BAA4B,EAAE,IAAI;AAAA,IAC1D;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzGA,GAAG,WAAW,eAAe;"}