{"version":3,"file":"result.js","sources":["pages/ancient/result.vue","pages/ancient/result.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <view class=\"header\">\r\n      <text class=\"title\">{{ textData.title }}</text>\r\n      <view class=\"stats\">\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ accuracy }}%</text>\r\n          <text class=\"stat-label\">正确率</text>\r\n        </view>\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ hintCount }}</text>\r\n          <text class=\"stat-label\">提示次数</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"diff-area\">\r\n      <view class=\"diff-label\">对比结果：</view>\r\n      <view class=\"diff-content\">\r\n        <text\r\n          v-for=\"(item, idx) in diffResult\"\r\n          :key=\"idx\"\r\n          :class=\"['diff-char', 'diff-' + item.status]\"\r\n        >{{ item.char }}</text>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"legend\">\r\n      <text class=\"legend-correct\">● 正确</text>\r\n      <text class=\"legend-missing\">● 遗漏/错误</text>\r\n    </view>\r\n\r\n    <view class=\"recognized-area\" v-if=\"recognizedText\">\r\n      <view class=\"diff-label\">识别文字：</view>\r\n      <text class=\"recognized-text\">{{ recognizedText }}</text>\r\n    </view>\r\n\r\n    <view class=\"action-area\">\r\n      <button type=\"primary\" class=\"btn\" @click=\"goReciteAgain\">\r\n        再背一次\r\n      </button>\r\n      <button class=\"btn btn-secondary\" @click=\"goHistory\">\r\n        查看历史\r\n      </button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { diffChars, calcAccuracy } from '@/common/diff.js'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      id: '',\r\n      textData: {},\r\n      recognizedText: '',\r\n      hintCount: 0,\r\n      duration: 0,\r\n      diffResult: [],\r\n      accuracy: 0,\r\n      saved: false\r\n    }\r\n  },\r\n  onLoad(options) {\r\n    this.id = options.id\r\n    const app = getApp()\r\n    const result = app.globalData && app.globalData.reciteResult\r\n    if (result) {\r\n      this.textData = result.textData\r\n      this.recognizedText = result.recognizedText\r\n      this.hintCount = result.hintCount\r\n      this.duration = Number(result.duration) || 0\r\n    }\r\n    this.doDiff()\r\n    this.saveRecord()\r\n  },\r\n  methods: {\r\n    doDiff() {\r\n      if (!this.textData.content) return\r\n      this.diffResult = diffChars(\r\n        this.textData.content,\r\n        this.recognizedText\r\n      )\r\n      this.accuracy = calcAccuracy(this.diffResult)\r\n    },\r\n    async saveRecord() {\r\n      if (this.saved) return\r\n      try {\r\n        await uniCloud.callFunction({\r\n          name: 'gw_recite-record',\r\n          data: {\r\n            action: 'save',\r\n            data: {\r\n              text_id: this.id,\r\n              text_title: this.textData.title,\r\n              hint_count: this.hintCount,\r\n              duration_seconds: this.duration,\r\n              recognized_text: this.recognizedText,\r\n              diff_result: this.diffResult,\r\n              accuracy: this.accuracy\r\n            }\r\n          }\r\n        })\r\n        this.saved = true\r\n      } catch (e) {\r\n        console.error('保存记录失败:', e)\r\n      }\r\n    },\r\n    goReciteAgain() {\r\n      uni.redirectTo({\r\n        url: `/pages/ancient/recite?id=${this.id}`\r\n      })\r\n    },\r\n    goHistory() {\r\n      uni.switchTab({\r\n        url: '/pages/ancient/history'\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  padding: 40rpx;\r\n  min-height: 100vh;\r\n  background: #f5f5f5;\r\n}\r\n.header {\r\n  text-align: center;\r\n  margin-bottom: 40rpx;\r\n}\r\n.title {\r\n  display: block;\r\n  font-size: 40rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 24rpx;\r\n}\r\n.stats {\r\n  display: flex;\r\n  justify-content: center;\r\n  gap: 80rpx;\r\n}\r\n.stat-item {\r\n  text-align: center;\r\n}\r\n.stat-value {\r\n  display: block;\r\n  font-size: 48rpx;\r\n  font-weight: bold;\r\n  color: #1890ff;\r\n}\r\n.stat-label {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n.diff-area {\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  padding: 30rpx;\r\n  margin-bottom: 20rpx;\r\n}\r\n.diff-label {\r\n  font-size: 26rpx;\r\n  color: #999;\r\n  margin-bottom: 16rpx;\r\n}\r\n.diff-content {\r\n  line-height: 2.2;\r\n}\r\n.diff-char {\r\n  font-size: 36rpx;\r\n  letter-spacing: 2rpx;\r\n}\r\n.diff-correct {\r\n  color: #52c41a;\r\n}\r\n.diff-punctuation {\r\n  color: #666;\r\n}\r\n.diff-missing, .diff-wrong {\r\n  color: #f5222d;\r\n  text-decoration: underline;\r\n}\r\n.legend {\r\n  display: flex;\r\n  gap: 40rpx;\r\n  margin-bottom: 24rpx;\r\n  padding: 0 10rpx;\r\n}\r\n.legend-correct {\r\n  font-size: 24rpx;\r\n  color: #52c41a;\r\n}\r\n.legend-missing {\r\n  font-size: 24rpx;\r\n  color: #f5222d;\r\n}\r\n.recognized-area {\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  padding: 30rpx;\r\n  margin-bottom: 40rpx;\r\n}\r\n.recognized-text {\r\n  font-size: 30rpx;\r\n  color: #666;\r\n  line-height: 1.8;\r\n}\r\n.action-area {\r\n  padding: 20rpx 0;\r\n}\r\n.btn {\r\n  width: 100%;\r\n  margin-bottom: 20rpx;\r\n  border-radius: 12rpx;\r\n}\r\n.btn-secondary {\r\n  background: #fff;\r\n  color: #333;\r\n  border: 1rpx solid #ddd;\r\n}\r\n</style>\r\n","import MiniProgramPage from '/Users/chensm/Desktop/my-source/github.com/simwy/AI-Recite-Ancient-Mobile/pages/ancient/result.vue'\nwx.createPage(MiniProgramPage)"],"names":["diffChars","calcAccuracy","uniCloud","uni"],"mappings":";;;AAmDA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,IAAI;AAAA,MACJ,UAAU,CAAE;AAAA,MACZ,gBAAgB;AAAA,MAChB,WAAW;AAAA,MACX,UAAU;AAAA,MACV,YAAY,CAAE;AAAA,MACd,UAAU;AAAA,MACV,OAAO;AAAA,IACT;AAAA,EACD;AAAA,EACD,OAAO,SAAS;AACd,SAAK,KAAK,QAAQ;AAClB,UAAM,MAAM,OAAO;AACnB,UAAM,SAAS,IAAI,cAAc,IAAI,WAAW;AAChD,QAAI,QAAQ;AACV,WAAK,WAAW,OAAO;AACvB,WAAK,iBAAiB,OAAO;AAC7B,WAAK,YAAY,OAAO;AACxB,WAAK,WAAW,OAAO,OAAO,QAAQ,KAAK;AAAA,IAC7C;AACA,SAAK,OAAO;AACZ,SAAK,WAAW;AAAA,EACjB;AAAA,EACD,SAAS;AAAA,IACP,SAAS;AACP,UAAI,CAAC,KAAK,SAAS;AAAS;AAC5B,WAAK,aAAaA,YAAS;AAAA,QACzB,KAAK,SAAS;AAAA,QACd,KAAK;AAAA,MACP;AACA,WAAK,WAAWC,yBAAa,KAAK,UAAU;AAAA,IAC7C;AAAA,IACD,MAAM,aAAa;AACjB,UAAI,KAAK;AAAO;AAChB,UAAI;AACF,cAAMC,cAAAA,GAAS,aAAa;AAAA,UAC1B,MAAM;AAAA,UACN,MAAM;AAAA,YACJ,QAAQ;AAAA,YACR,MAAM;AAAA,cACJ,SAAS,KAAK;AAAA,cACd,YAAY,KAAK,SAAS;AAAA,cAC1B,YAAY,KAAK;AAAA,cACjB,kBAAkB,KAAK;AAAA,cACvB,iBAAiB,KAAK;AAAA,cACtB,aAAa,KAAK;AAAA,cAClB,UAAU,KAAK;AAAA,YACjB;AAAA,UACF;AAAA,SACD;AACD,aAAK,QAAQ;AAAA,MACf,SAAS,GAAG;AACVC,sBAAAA,wDAAc,WAAW,CAAC;AAAA,MAC5B;AAAA,IACD;AAAA,IACD,gBAAgB;AACdA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,4BAA4B,KAAK,EAAE;AAAA,OACzC;AAAA,IACF;AAAA,IACD,YAAY;AACVA,oBAAAA,MAAI,UAAU;AAAA,QACZ,KAAK;AAAA,OACN;AAAA,IACH;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;ACvHA,GAAG,WAAW,eAAe;"}