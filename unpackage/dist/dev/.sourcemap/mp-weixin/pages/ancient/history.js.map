{"version":3,"file":"history.js","sources":["pages/ancient/history.vue","pages/ancient/history.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <view class=\"list\" v-if=\"list.length > 0\">\r\n      <view\r\n        class=\"list-item\"\r\n        v-for=\"item in list\"\r\n        :key=\"item._id\"\r\n        @click=\"toggleDetail(item._id)\"\r\n      >\r\n        <view class=\"item-header\">\r\n          <text class=\"item-title\">{{ item.text_title }}</text>\r\n          <view class=\"item-right\">\r\n            <text class=\"item-accuracy\">{{ item.accuracy || 0 }}%</text>\r\n            <text class=\"item-delete\" @click.stop=\"confirmDelete(item)\">删除</text>\r\n          </view>\r\n        </view>\r\n        <view class=\"item-meta\">\r\n          <text>提示 {{ item.hint_count }} 次</text>\r\n          <text class=\"item-time\">{{ formatTime(item.created_at) }}</text>\r\n        </view>\r\n\r\n        <!-- 展开的对比详情 -->\r\n        <view class=\"item-detail\" v-if=\"expandedId === item._id\">\r\n          <view class=\"diff-content\">\r\n            <text\r\n              v-for=\"(d, idx) in (item.diff_result || [])\"\r\n              :key=\"idx\"\r\n              :class=\"['diff-char', 'diff-' + d.status]\"\r\n            >{{ d.char }}</text>\r\n          </view>\r\n          <view class=\"recognized\" v-if=\"item.recognized_text\">\r\n            <text class=\"recognized-label\">识别文字：</text>\r\n            <text class=\"recognized-text\">{{ item.recognized_text }}</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"empty\" v-else-if=\"!loading\">\r\n      <text>暂无背诵记录</text>\r\n    </view>\r\n\r\n    <view class=\"loading\" v-if=\"loading\">\r\n      <text>加载中...</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      list: [],\r\n      loading: false,\r\n      page: 1,\r\n      total: 0,\r\n      expandedId: '',\r\n      deletingId: ''\r\n    }\r\n  },\r\n  onShow() {\r\n    this.page = 1\r\n    this.loadData()\r\n  },\r\n  onPullDownRefresh() {\r\n    this.page = 1\r\n    this.loadData().then(() => uni.stopPullDownRefresh())\r\n  },\r\n  onReachBottom() {\r\n    if (this.list.length < this.total) {\r\n      this.page++\r\n      this.loadData(true)\r\n    }\r\n  },\r\n  methods: {\r\n    async loadData(append = false) {\r\n      this.loading = true\r\n      try {\r\n        const res = await uniCloud.callFunction({\r\n          name: 'recite-record',\r\n          data: {\r\n            action: 'list',\r\n            data: { page: this.page, pageSize: 20 }\r\n          }\r\n        })\r\n        const result = (res && res.result) || {}\r\n        if (result.code !== 0 || !result.data) {\r\n          throw new Error(result.msg || '加载失败')\r\n        }\r\n        const { list, total } = result.data\r\n        this.list = append ? [...this.list, ...list] : list\r\n        this.total = total\r\n      } catch (e) {\r\n        uni.showToast({\r\n          title: (e && e.message) || '加载失败',\r\n          icon: 'none'\r\n        })\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    toggleDetail(id) {\r\n      this.expandedId = this.expandedId === id ? '' : id\r\n    },\r\n    async confirmDelete(item) {\r\n      if (!item || !item._id || this.deletingId) return\r\n      const modalRes = await new Promise(resolve => {\r\n        uni.showModal({\r\n          title: '删除记录',\r\n          content: '确定删除这条背诵记录吗？删除后不可恢复。',\r\n          confirmText: '删除',\r\n          confirmColor: '#f5222d',\r\n          success: resolve,\r\n          fail: () => resolve({ confirm: false })\r\n        })\r\n      })\r\n      if (!modalRes.confirm) return\r\n      this.deleteRecord(item._id)\r\n    },\r\n    async deleteRecord(id) {\r\n      this.deletingId = id\r\n      try {\r\n        const res = await uniCloud.callFunction({\r\n          name: 'recite-record',\r\n          data: {\r\n            action: 'delete',\r\n            data: { id }\r\n          }\r\n        })\r\n        const result = (res && res.result) || {}\r\n        if (result.code !== 0) {\r\n          throw new Error(result.msg || '删除失败')\r\n        }\r\n        this.list = this.list.filter(item => item._id !== id)\r\n        this.total = Math.max(0, this.total - 1)\r\n        if (this.expandedId === id) {\r\n          this.expandedId = ''\r\n        }\r\n        uni.showToast({\r\n          title: '删除成功',\r\n          icon: 'success'\r\n        })\r\n      } catch (e) {\r\n        uni.showToast({\r\n          title: (e && e.message) || '删除失败',\r\n          icon: 'none'\r\n        })\r\n      } finally {\r\n        this.deletingId = ''\r\n      }\r\n    },\r\n    formatTime(ts) {\r\n      if (!ts) return ''\r\n      const d = new Date(ts)\r\n      const pad = n => String(n).padStart(2, '0')\r\n      return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  padding: 20rpx;\r\n  min-height: 100vh;\r\n  background: #f5f5f5;\r\n}\r\n.list-item {\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  padding: 24rpx;\r\n  margin-bottom: 16rpx;\r\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.06);\r\n}\r\n.item-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 12rpx;\r\n}\r\n.item-right {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.item-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n.item-accuracy {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #1890ff;\r\n}\r\n.item-delete {\r\n  margin-left: 20rpx;\r\n  font-size: 24rpx;\r\n  color: #f5222d;\r\n}\r\n.item-meta {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n.item-detail {\r\n  margin-top: 20rpx;\r\n  padding-top: 20rpx;\r\n  border-top: 1rpx solid #f0f0f0;\r\n}\r\n.diff-content {\r\n  line-height: 2;\r\n  margin-bottom: 16rpx;\r\n}\r\n.diff-char {\r\n  font-size: 32rpx;\r\n}\r\n.diff-correct {\r\n  color: #52c41a;\r\n}\r\n.diff-missing, .diff-wrong {\r\n  color: #f5222d;\r\n  text-decoration: underline;\r\n}\r\n.recognized-label {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n.recognized-text {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  line-height: 1.6;\r\n}\r\n.empty, .loading {\r\n  text-align: center;\r\n  padding: 100rpx 0;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from '/Users/chensm/Desktop/my-source/github.com/simwy/AI-Recite-Ancient-Mobile/pages/ancient/history.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}