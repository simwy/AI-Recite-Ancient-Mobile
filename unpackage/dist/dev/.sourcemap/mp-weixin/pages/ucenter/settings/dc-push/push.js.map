{"version":3,"file":"push.js","sources":["pages/ucenter/settings/dc-push/push.js"],"sourcesContent":["/**\n * 判断Push是否开启\n */\nfunction isTurnedOnPush(){\n\tvar isOn = undefined;\n\ttry{\n\t\tif('iOS' == plus.os.name){\n\t\t\tvar types = 0;\n\t\t\tvar app = plus.ios.invoke('UIApplication', 'sharedApplication');\n\t\t\tvar settings = plus.ios.invoke(app, 'currentUserNotificationSettings');\n\t\t\tif(settings){\n\t\t\t\ttypes = settings.plusGetAttribute('types');\n\t\t\t\tplus.ios.deleteObject(settings);\n\t\t\t}else{\n\t\t\t\ttypes = plus.ios.invoke(app, 'enabledRemoteNotificationTypes');\n\t\t\t}\n\t\t\tplus.ios.deleteObject(app);\n\t\t\tisOn = (0!=types);\n\t\t}else{\n\t\t\tvar main = plus.android.runtimeMainActivity();\n\t\t\tvar manager = plus.android.invoke('com.igexin.sdk.PushManager', 'getInstance');\n\t\t\tisOn = plus.android.invoke(manager, 'isPushTurnedOn', main);\n\t\t}\n\t}catch(e){\n\t\tconsole.error('exception in isTurnedOnPush@dc-push!!');\n\t}\n\treturn isOn;\n}\n\n/**\n * 打开Push\n * Android平台 - 打开个推（UniPush）的推送通道\n * iOS平台 - 如果开启通知功能，则打开应用的设置页面引导用户开启通知\n */\nfunction turnOnPush(){\n\ttry{\n\t\tif('iOS' == plus.os.name){\n\t\t\t// 如果设置中没有开启通知，则打开应用的设置界面\n\t\t\tif(!isTurnedOnPush()){\n\t\t\t\tsettingInIos();\n\t\t\t}\n\t\t}else{\n\t\t\tvar main = plus.android.runtimeMainActivity();\n\t\t\tvar manager = plus.android.invoke('com.igexin.sdk.PushManager', 'getInstance');\n\t\t\tplus.android.invoke(manager, 'turnOnPush', main);\n\t\t}\n\t}catch(e){\n\t\tconsole.error('exception in turnOnPush@dc-push!!');\n\t}\n}\n\n/**\n * 关闭Push\n * Android平台 - 关闭个推（UniPush）的推送通道\n * iOS平台 - 不做任何操作\n */\nfunction trunOffPush(){\n\ttry{\n\t\tif('iOS' == plus.os.name){\n\t\t\t// 这里不做任何操作（不引导用户关闭应用的推送能力），应该通知业务服务器不向此用户下发推送消息\n\t\t}else{\n\t\t\tvar main = plus.android.runtimeMainActivity();\n\t\t\tvar manager = plus.android.invoke('com.igexin.sdk.PushManager', 'getInstance');\n\t\t\tplus.android.invoke(manager, 'turnOffPush', main);\n\t\t}\n\t}catch(e){\n\t\tconsole.error('exception in trunOffPush@dc-push!!');\n\t}\n}\n\n/**\n * iOS平台打开应用设置界面\n */\nfunction settingInIos(){\n\ttry{\n\tif('iOS' == plus.os.name){\n\t\tvar app = plus.ios.invoke('UIApplication', 'sharedApplication');\n\t\tvar setting = plus.ios.invoke('NSURL', 'URLWithString:', 'app-settings:');\n\t\tplus.ios.invoke(app, 'openURL:', setting);\n\t\tplus.ios.deleteObject(setting);\n\t\tplus.ios.deleteObject(app);\n\t}\n\t}catch(e){\n\t\tconsole.error('exception in settingInIos@dc-push!!');\n\t}\n}\n/**\n * android打开应用设置页面\n */\nfunction settingInAndroid(){\n\tif (uni.getSystemInfoSync().platform == \"android\") {\n\t\tvar main = plus.android.runtimeMainActivity();\n\t\tvar Intent = plus.android.importClass('android.content.Intent');  \n\t\tvar Settings = plus.android.importClass('android.provider.Settings');  \n\t\tvar intent = new Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);\n\t\t// 安卓跳转设置页面详细查看(https://ask.dcloud.net.cn/question/14732)\n\t\tmain.startActivity(intent);\n\t}\n}\n/**\n * 打开应用设置界面\n */\nfunction setting(){\n\tif (uni.getSystemInfoSync().platform == \"ios\") {\n\t\tsettingInIos();\n\t}\n\tif (uni.getSystemInfoSync().platform == \"android\") {\n\t\tsettingInAndroid();\n\t}\n}\n\nexport default {\n\tisOn: isTurnedOnPush,\n\tiosSetting: settingInIos,\n\ton: turnOnPush,\n\toff: trunOffPush,\n\tsetting:setting\n}\n"],"names":["uni","setting"],"mappings":";;AAGA,SAAS,iBAAgB;AACxB,MAAI,OAAO;AACX,MAAG;AACF,QAAG,SAAS,KAAK,GAAG,MAAK;AACxB,UAAI,QAAQ;AACZ,UAAI,MAAM,KAAK,IAAI,OAAO,iBAAiB,mBAAmB;AAC9D,UAAI,WAAW,KAAK,IAAI,OAAO,KAAK,iCAAiC;AACrE,UAAG,UAAS;AACX,gBAAQ,SAAS,iBAAiB,OAAO;AACzC,aAAK,IAAI,aAAa,QAAQ;AAAA,MAClC,OAAQ;AACJ,gBAAQ,KAAK,IAAI,OAAO,KAAK,gCAAgC;AAAA,MAC7D;AACD,WAAK,IAAI,aAAa,GAAG;AACzB,aAAQ,KAAG;AAAA,IACd,OAAO;AACJ,UAAI,OAAO,KAAK,QAAQ,oBAAmB;AAC3C,UAAI,UAAU,KAAK,QAAQ,OAAO,8BAA8B,aAAa;AAC7E,aAAO,KAAK,QAAQ,OAAO,SAAS,kBAAkB,IAAI;AAAA,IAC1D;AAAA,EACD,SAAM,GAAE;AACRA,kBAAAA,MAAc,MAAA,SAAA,gDAAA,uCAAuC;AAAA,EACrD;AACD,SAAO;AACR;AAOA,SAAS,aAAY;AACpB,MAAG;AACF,QAAG,SAAS,KAAK,GAAG,MAAK;AAExB,UAAG,CAAC,eAAc,GAAG;AACpB;MACA;AAAA,IACJ,OAAO;AACJ,UAAI,OAAO,KAAK,QAAQ,oBAAmB;AAC3C,UAAI,UAAU,KAAK,QAAQ,OAAO,8BAA8B,aAAa;AAC7E,WAAK,QAAQ,OAAO,SAAS,cAAc,IAAI;AAAA,IAC/C;AAAA,EACD,SAAM,GAAE;AACRA,kBAAAA,MAAc,MAAA,SAAA,gDAAA,mCAAmC;AAAA,EACjD;AACF;AAOA,SAAS,cAAa;AACrB,MAAG;AACF,QAAG,SAAS,KAAK,GAAG,MAAK;AAAA,IAE3B,OAAO;AACJ,UAAI,OAAO,KAAK,QAAQ,oBAAmB;AAC3C,UAAI,UAAU,KAAK,QAAQ,OAAO,8BAA8B,aAAa;AAC7E,WAAK,QAAQ,OAAO,SAAS,eAAe,IAAI;AAAA,IAChD;AAAA,EACD,SAAM,GAAE;AACRA,kBAAAA,MAAc,MAAA,SAAA,gDAAA,oCAAoC;AAAA,EAClD;AACF;AAKA,SAAS,eAAc;AACtB,MAAG;AACH,QAAG,SAAS,KAAK,GAAG,MAAK;AACxB,UAAI,MAAM,KAAK,IAAI,OAAO,iBAAiB,mBAAmB;AAC9D,UAAIC,WAAU,KAAK,IAAI,OAAO,SAAS,kBAAkB,eAAe;AACxE,WAAK,IAAI,OAAO,KAAK,YAAYA,QAAO;AACxC,WAAK,IAAI,aAAaA,QAAO;AAC7B,WAAK,IAAI,aAAa,GAAG;AAAA,IACzB;AAAA,EACA,SAAM,GAAE;AACRD,kBAAAA,MAAc,MAAA,SAAA,gDAAA,qCAAqC;AAAA,EACnD;AACF;AAIA,SAAS,mBAAkB;AAC1B,MAAIA,oBAAI,oBAAoB,YAAY,WAAW;AAClD,QAAI,OAAO,KAAK,QAAQ,oBAAmB;AAC3C,QAAI,SAAS,KAAK,QAAQ,YAAY,wBAAwB;AAC9D,QAAI,WAAW,KAAK,QAAQ,YAAY,2BAA2B;AACnE,QAAI,SAAS,IAAI,OAAO,SAAS,mCAAmC;AAEpE,SAAK,cAAc,MAAM;AAAA,EACzB;AACF;AAIA,SAAS,UAAS;AACjB,MAAIA,oBAAI,oBAAoB,YAAY,OAAO;AAC9C;EACA;AACD,MAAIA,oBAAI,oBAAoB,YAAY,WAAW;AAClD;EACA;AACF;AAEA,MAAe,aAAA;AAAA,EACd,MAAM;AAAA,EACN,YAAY;AAAA,EACZ,IAAI;AAAA,EACJ,KAAK;AAAA,EACL;AACD;;"}