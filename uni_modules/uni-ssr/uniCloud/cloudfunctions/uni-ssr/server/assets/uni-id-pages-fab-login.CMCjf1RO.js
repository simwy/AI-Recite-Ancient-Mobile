"use strict";const e=require("@dcloudio/uni-h5"),t=require("@dcloudio/uni-cloud"),i=require("../entry-server.js"),o=require("./store.Cv4WGu-a.js"),n=require("vue"),s=require("./_plugin-vue_export-helper.BDcHAK_d.js"),l={computed:{agreements(){if(!i.config$1.agreements)return[];let{serviceUrl:e,privacyUrl:t}=i.config$1.agreements;return[{url:e,title:"用户服务协议"},{url:t,title:"隐私政策条款"}]},agree:{get(){return this.getParentComponent().agree},set(e){return this.getParentComponent().agree=e}}},data:()=>({servicesList:[{id:"username",text:"账号登录",logo:"/uni_modules/uni-id-pages/static/login/uni-fab-login/user.png",path:"/uni_modules/uni-id-pages/pages/login/login-withpwd"},{id:"smsCode",text:"短信验证码",logo:"/uni_modules/uni-id-pages/static/login/uni-fab-login/sms.png",path:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=smsCode"},{id:"weixin",text:"微信登录",logo:"/uni_modules/uni-id-pages/static/login/uni-fab-login/weixin.png"},{id:"huawei",text:"华为登录",logo:"/uni_modules/uni-id-pages/static/login/uni-fab-login/huawei.png",path:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=huawei"},{id:"huaweiMobile",text:"华为账号一键登录",logo:"/uni_modules/uni-id-pages/static/login/uni-fab-login/huawei.png",path:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=huaweiMobile"},{id:"apple",text:"苹果登录",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/apple.png"},{id:"univerify",text:"一键登录",logo:"/uni_modules/uni-id-pages/static/app/uni-fab-login/univerify.png"},{id:"taobao",text:"淘宝登录",logo:"/uni_modules/uni-id-pages/static/app/uni-fab-login/taobao.png"},{id:"facebook",text:"脸书登录",logo:"/uni_modules/uni-id-pages/static/app/uni-fab-login/facebook.png"},{id:"alipay",text:"支付宝登录",logo:"/uni_modules/uni-id-pages/static/app/uni-fab-login/alipay.png"},{id:"qq",text:"QQ登录",logo:"/uni_modules/uni-id-pages/static/app/uni-fab-login/qq.png"},{id:"google",text:"谷歌登录",logo:"/uni_modules/uni-id-pages/static/app/uni-fab-login/google.png"},{id:"douyin",text:"抖音登录",logo:"/uni_modules/uni-id-pages/static/app/uni-fab-login/douyin.png"},{id:"sinaweibo",text:"新浪微博",logo:"/uni_modules/uni-id-pages/static/app/uni-fab-login/sinaweibo.png"}],univerifyStyle:{fullScreen:!0,backgroundColor:"#ffffff",buttons:{iconWidth:"45px",list:[]},privacyTerms:{defaultCheckBoxState:!1,textColor:"#BBBBBB",termsColor:"#5496E3",prefix:"我已阅读并同意",suffix:"并使用本机号码登录",privacyItems:[]}}}),watch:{agree(e){this.univerifyStyle.privacyTerms.defaultCheckBoxState=e}},async created(){let e=this.servicesList,t=i.config$1.loginTypes;e=e.filter((e=>"apple"!=e.id&&t.includes(e.id))),t.includes("univerify")&&(this.univerifyStyle.privacyTerms.privacyItems=this.agreements,e.forEach((({id:e,logo:t,path:i})=>{"univerify"!=e&&this.univerifyStyle.buttons.list.push({iconPath:t,provider:e,path:i})}))),this.servicesList=e.filter((e=>(e.path?e.path.split("?")[0]:"")!=this.getRoute(1)))},methods:{getParentComponent(){return this.$parent.$parent},setUserInfo(e){console.log("setUserInfo",e)},getRoute(t=0){let i=e.getCurrentPages();return t>i.length?"":"/"+i[i.length-t].route},toPage(t,i=0){if(console.log("比较",this.getRoute(1),this.getRoute(2),t),this.getRoute(1)==t.split("?")[0]&&"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"==this.getRoute(1)){let i=t.split("?")[1].split("=")[1];e.$emit("uni-id-pages-setLoginType",i)}else this.getRoute(2)==t?e.navigateBack():this.getRoute(1)!=t?0===i?e.navigateTo({url:t,animationType:"slide-in-left",complete(e){}}):e.redirectTo({url:t,animationType:"slide-in-left",complete(e){}}):console.log("出乎意料的情况,path："+t)},async login_before(t,o=!0,n={}){var s,l;if(console.log(t,n),["qq","xiaomi","sinaweibo","taobao","facebook","google","alipay","douyin"].includes(t))return e.showToast({title:"该登录方式暂未实现，欢迎提交pr",icon:"none",duration:3e3});if(console.log("检查当前环境是否支持这种登录方式"),["univerify","apple"].includes(t))return e.showToast({title:"当前设备不支持此登录，请选择其他登录方式",icon:"none",duration:3e3});let a=((null==(l=null==(s=i.config$1)?void 0:s.agreements)?void 0:l.scope)||[]).includes("register");if("univerify"!=t&&a&&!this.agree){return this.getParentComponent().$refs.agreements.popup((()=>{this.login_before(t,o,n)}))}if("weixin"==t){const e="https://gw.shiyuankeji.cn/";let t=location.protocol+"//"+location.host+e.replace(/\/$/,"")+(window.location.href.includes("#")?"/#":"")+"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?is_weixin_redirect=true&type=weixin";return"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?window.open(`https://open.weixin.qq.com/connect/oauth2/authorize?\n\t\t\t\t\t\t\t\t\t\tappid=${i.config$1.appid.weixin.h5}\n\t\t\t\t\t\t\t\t\t\t&redirect_uri=${encodeURIComponent(t)}\n\t\t\t\t\t\t\t\t\t\t&response_type=code\n\t\t\t\t\t\t\t\t\t\t&scope=snsapi_userinfo\n\t\t\t\t\t\t\t\t\t\t&state=STATE&connect_redirect=1#wechat_redirect`):location.href=`https://open.weixin.qq.com/connect/qrconnect?appid=${i.config$1.appid.weixin.web}\n\t\t\t\t\t\t\t\t\t\t\t&redirect_uri=${encodeURIComponent(t)}\n\t\t\t\t\t\t\t\t\t\t\t&response_type=code&scope=snsapi_login&state=STATE#wechat_redirect`}if(console.log("login ----"),e.showLoading({mask:!0}),"univerify"==t){let t=function(){e.hideLoading(),i.close(),i.offButtonsClick(n)},i=uni.getUniverifyManager(),o=!1,n=async i=>{console.log("点击了第三方登录，provider：",i,i.provider,this.univerifyStyle.buttons.list),o=!0;let n=await uni.getCheckBoxState();this.agree=n.state;let{path:s}=this.univerifyStyle.buttons.list[i.index];s?(this.getRoute(1).includes("login-withoutpwd")&&s.includes("login-withoutpwd")&&this.getParentComponent().showCurrentWebview(),this.toPage(s,1),t()):this.agree?(t(),setTimeout((()=>{this.login_before(i.provider)}),500)):e.showToast({title:"你未同意隐私政策协议",icon:"none",duration:3e3})};return i.onButtonsClick(n),i.login({univerifyStyle:this.univerifyStyle,success:e=>{this.login(e.authResult,"univerify")},fail(t){console.log(t),o||e.navigateBack()},complete:async t=>{e.hideLoading(),i.offButtonsClick(n)}})}if("weixinMobile"===t||"huaweiMobile"===t)return this.login({phoneCode:n.phoneNumberCode},t);e.login({provider:t,onlyAuthorize:!0,success:async i=>{if("apple"==t){let t=await this.getUserInfo({provider:"apple"});Object.assign(i.authResult,t.userInfo),e.hideLoading()}this.login(["huawei","weixin"].includes(t)?{code:i.code}:i.authResult,t)},fail:async t=>{console.error(JSON.stringify(t)),e.showModal({content:`登录失败; code: ${t.errCode||-1}`,confirmText:"知道了",showCancel:!1}),e.hideLoading()}})},login(i,n){console.log({params:i,type:n});let s="loginBy"+n.trim().replace(n[0],n[0].toUpperCase());t.importObject("uni-id-co",{customUI:!0})[s](i).then((t=>{e.showToast({title:"登录成功",icon:"none",duration:2e3}),t.loginType=n,o.mutations.loginSuccess(t)})).catch((t=>{e.showModal({content:t.message,confirmText:"知道了",showCancel:!1})})).finally((t=>{"univerify"==n&&uni.closeAuthView(),e.hideLoading()}))},getUserInfo:async t=>new Promise(((i,o)=>{uni.getUserInfo({...t,success:e=>{i(e)},fail:t=>{e.showModal({content:JSON.stringify(t),showCancel:!1}),o(t)}})}))}};const a=l.setup;l.setup=(e,t)=>{const i=n.useSSRContext();return(i.modules||(i.modules=new Set)).add("uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue"),a?a(e,t):void 0};const r=s._export_sfc(l,[["ssrRender",function(t,i,o,l,a,r,u,c){const g=e.View,p=e.Image,d=e.Text;i(s.ssrRenderComponent(g,l,{default:n.withCtx(((e,t,i,o)=>{if(!t)return[n.createVNode(g,{class:"fab-login-box"},{default:n.withCtx((()=>[(n.openBlock(!0),n.createBlock(n.Fragment,null,n.renderList(u.servicesList,((e,t)=>(n.openBlock(),n.createBlock(g,{class:"item",key:t,onClick:t=>e.path?c.toPage(e.path):c.login_before(e.id,!1)},{default:n.withCtx((()=>[n.createVNode(p,{class:"logo",src:e.logo,mode:"scaleToFill"},null,8,["src"]),n.createVNode(d,{class:"login-title"},{default:n.withCtx((()=>[n.createTextVNode(n.toDisplayString(e.text),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})];t(s.ssrRenderComponent(g,{class:"fab-login-box"},{default:n.withCtx(((e,t,i,o)=>{if(!t)return[(n.openBlock(!0),n.createBlock(n.Fragment,null,n.renderList(u.servicesList,((e,t)=>(n.openBlock(),n.createBlock(g,{class:"item",key:t,onClick:t=>e.path?c.toPage(e.path):c.login_before(e.id,!1)},{default:n.withCtx((()=>[n.createVNode(p,{class:"logo",src:e.logo,mode:"scaleToFill"},null,8,["src"]),n.createVNode(d,{class:"login-title"},{default:n.withCtx((()=>[n.createTextVNode(n.toDisplayString(e.text),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))];t("\x3c!--[--\x3e"),s.ssrRenderList(u.servicesList,((e,l)=>{t(s.ssrRenderComponent(g,{class:"item",key:l,onClick:t=>e.path?c.toPage(e.path):c.login_before(e.id,!1)},{default:n.withCtx(((t,i,o,l)=>{if(!i)return[n.createVNode(p,{class:"logo",src:e.logo,mode:"scaleToFill"},null,8,["src"]),n.createVNode(d,{class:"login-title"},{default:n.withCtx((()=>[n.createTextVNode(n.toDisplayString(e.text),1)])),_:2},1024)];i(s.ssrRenderComponent(p,{class:"logo",src:e.logo,mode:"scaleToFill"},null,o,l)),i(s.ssrRenderComponent(d,{class:"login-title"},{default:n.withCtx(((t,i,o,l)=>{if(!i)return[n.createTextVNode(n.toDisplayString(e.text),1)];i(`${s.ssrInterpolate(e.text)}`)})),_:2},o,l))})),_:2},i,o))})),t("\x3c!--]--\x3e")})),_:1},i,o))})),_:1},o))}],["__scopeId","data-v-5c14e513"]]);exports.__easycom_9=r;
