"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("@dcloudio/uni-h5"),t=require("@dcloudio/uni-cloud"),a=require("vue"),s=require("./_plugin-vue_export-helper.BDcHAK_d.js");function r(e){return e.replace(/[，。、；：？！""''（）《》\s\n\r,.;:?!'"()\[\]{}]/g,"")}function c(e,t){const a=r(e),s=r(t),c=function(e,t){const a=e.length,s=t.length,r=Array.from({length:a+1},(()=>new Array(s+1).fill(0)));for(let c=1;c<=a;c++)for(let a=1;a<=s;a++)e[c-1]===t[a-1]?r[c][a]=r[c-1][a-1]+1:r[c][a]=Math.max(r[c-1][a],r[c][a-1]);return r}(a,s),i=[];let o=a.length,l=s.length;const d=[];for(;o>0&&l>0;)a[o-1]===s[l-1]?(d.unshift({i:o-1,j:l-1,match:!0}),o--,l--):c[o-1][l]>=c[o][l-1]?o--:l--;let n=0;for(let r=0;r<a.length;r++)n<d.length&&d[n].i===r?(i.push({char:a[r],status:"correct"}),n++):i.push({char:a[r],status:"missing"});return i}require("@vue/shared");const i={data:()=>({id:"",textData:{},recognizedText:"",hintCount:0,duration:0,diffResult:[],accuracy:0,saved:!1}),onLoad(t){this.id=t.id;const a=e.getApp(),s=a.globalData&&a.globalData.reciteResult;s&&(this.textData=s.textData,this.recognizedText=s.recognizedText,this.hintCount=s.hintCount,this.duration=Number(s.duration)||0),this.doDiff(),this.saveRecord()},methods:{doDiff(){this.textData.content&&(this.diffResult=c(this.textData.content,this.recognizedText),this.accuracy=function(e){if(!e||0===e.length)return 0;const t=e.filter((e=>"correct"===e.status)).length;return Math.round(t/e.length*100)}(this.diffResult))},async saveRecord(){if(!this.saved)try{await t.callFunction({name:"recite-record",data:{action:"save",data:{text_id:this.id,text_title:this.textData.title,hint_count:this.hintCount,duration_seconds:this.duration,recognized_text:this.recognizedText,diff_result:this.diffResult,accuracy:this.accuracy}}}),this.saved=!0}catch(e){console.error("保存记录失败:",e)}},goReciteAgain(){e.redirectTo({url:`/pages/ancient/recite?id=${this.id}`})},goHistory(){e.switchTab({url:"/pages/ancient/history"})}}};const o=i.setup;i.setup=(e,t)=>{const s=a.useSSRContext();return(s.modules||(s.modules=new Set)).add("pages/ancient/result.vue"),o?o(e,t):void 0};const l=s._export_sfc(i,[["ssrRender",function(t,r,c,i,o,l,d,n){const u=e.View,f=e.Text,x=e.Button;r(s.ssrRenderComponent(u,a.mergeProps({class:"container"},i),{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createVNode(u,{class:"header"},{default:a.withCtx((()=>[a.createVNode(f,{class:"title"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.textData.title),1)])),_:1}),a.createVNode(u,{class:"stats"},{default:a.withCtx((()=>[a.createVNode(u,{class:"stat-item"},{default:a.withCtx((()=>[a.createVNode(f,{class:"stat-value"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.accuracy)+"%",1)])),_:1}),a.createVNode(f,{class:"stat-label"},{default:a.withCtx((()=>[a.createTextVNode("正确率")])),_:1})])),_:1}),a.createVNode(u,{class:"stat-item"},{default:a.withCtx((()=>[a.createVNode(f,{class:"stat-value"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.hintCount),1)])),_:1}),a.createVNode(f,{class:"stat-label"},{default:a.withCtx((()=>[a.createTextVNode("提示次数")])),_:1})])),_:1})])),_:1})])),_:1}),a.createVNode(u,{class:"diff-area"},{default:a.withCtx((()=>[a.createVNode(u,{class:"diff-label"},{default:a.withCtx((()=>[a.createTextVNode("对比结果：")])),_:1}),a.createVNode(u,{class:"diff-content"},{default:a.withCtx((()=>[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(d.diffResult,((e,t)=>(a.openBlock(),a.createBlock(f,{key:t,class:["diff-char","diff-"+e.status]},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.char),1)])),_:2},1032,["class"])))),128))])),_:1})])),_:1}),a.createVNode(u,{class:"legend"},{default:a.withCtx((()=>[a.createVNode(f,{class:"legend-correct"},{default:a.withCtx((()=>[a.createTextVNode("● 正确")])),_:1}),a.createVNode(f,{class:"legend-missing"},{default:a.withCtx((()=>[a.createTextVNode("● 遗漏/错误")])),_:1})])),_:1}),d.recognizedText?(a.openBlock(),a.createBlock(u,{key:0,class:"recognized-area"},{default:a.withCtx((()=>[a.createVNode(u,{class:"diff-label"},{default:a.withCtx((()=>[a.createTextVNode("识别文字：")])),_:1}),a.createVNode(f,{class:"recognized-text"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.recognizedText),1)])),_:1})])),_:1})):a.createCommentVNode("",!0),a.createVNode(u,{class:"action-area"},{default:a.withCtx((()=>[a.createVNode(x,{type:"primary",class:"btn",onClick:n.goReciteAgain},{default:a.withCtx((()=>[a.createTextVNode(" 再背一次 ")])),_:1},8,["onClick"]),a.createVNode(x,{class:"btn btn-secondary",onClick:n.goHistory},{default:a.withCtx((()=>[a.createTextVNode(" 查看历史 ")])),_:1},8,["onClick"])])),_:1})];t(s.ssrRenderComponent(u,{class:"header"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createVNode(f,{class:"title"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.textData.title),1)])),_:1}),a.createVNode(u,{class:"stats"},{default:a.withCtx((()=>[a.createVNode(u,{class:"stat-item"},{default:a.withCtx((()=>[a.createVNode(f,{class:"stat-value"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.accuracy)+"%",1)])),_:1}),a.createVNode(f,{class:"stat-label"},{default:a.withCtx((()=>[a.createTextVNode("正确率")])),_:1})])),_:1}),a.createVNode(u,{class:"stat-item"},{default:a.withCtx((()=>[a.createVNode(f,{class:"stat-value"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.hintCount),1)])),_:1}),a.createVNode(f,{class:"stat-label"},{default:a.withCtx((()=>[a.createTextVNode("提示次数")])),_:1})])),_:1})])),_:1})];t(s.ssrRenderComponent(f,{class:"title"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createTextVNode(a.toDisplayString(d.textData.title),1)];t(`${s.ssrInterpolate(d.textData.title)}`)})),_:1},r,c)),t(s.ssrRenderComponent(u,{class:"stats"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createVNode(u,{class:"stat-item"},{default:a.withCtx((()=>[a.createVNode(f,{class:"stat-value"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.accuracy)+"%",1)])),_:1}),a.createVNode(f,{class:"stat-label"},{default:a.withCtx((()=>[a.createTextVNode("正确率")])),_:1})])),_:1}),a.createVNode(u,{class:"stat-item"},{default:a.withCtx((()=>[a.createVNode(f,{class:"stat-value"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.hintCount),1)])),_:1}),a.createVNode(f,{class:"stat-label"},{default:a.withCtx((()=>[a.createTextVNode("提示次数")])),_:1})])),_:1})];t(s.ssrRenderComponent(u,{class:"stat-item"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createVNode(f,{class:"stat-value"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.accuracy)+"%",1)])),_:1}),a.createVNode(f,{class:"stat-label"},{default:a.withCtx((()=>[a.createTextVNode("正确率")])),_:1})];t(s.ssrRenderComponent(f,{class:"stat-value"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createTextVNode(a.toDisplayString(d.accuracy)+"%",1)];t(`${s.ssrInterpolate(d.accuracy)}%`)})),_:1},r,c)),t(s.ssrRenderComponent(f,{class:"stat-label"},{default:a.withCtx(((e,t,s,r)=>{if(!t)return[a.createTextVNode("正确率")];t("正确率")})),_:1},r,c))})),_:1},r,c)),t(s.ssrRenderComponent(u,{class:"stat-item"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createVNode(f,{class:"stat-value"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.hintCount),1)])),_:1}),a.createVNode(f,{class:"stat-label"},{default:a.withCtx((()=>[a.createTextVNode("提示次数")])),_:1})];t(s.ssrRenderComponent(f,{class:"stat-value"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createTextVNode(a.toDisplayString(d.hintCount),1)];t(`${s.ssrInterpolate(d.hintCount)}`)})),_:1},r,c)),t(s.ssrRenderComponent(f,{class:"stat-label"},{default:a.withCtx(((e,t,s,r)=>{if(!t)return[a.createTextVNode("提示次数")];t("提示次数")})),_:1},r,c))})),_:1},r,c))})),_:1},r,c))})),_:1},r,c)),t(s.ssrRenderComponent(u,{class:"diff-area"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createVNode(u,{class:"diff-label"},{default:a.withCtx((()=>[a.createTextVNode("对比结果：")])),_:1}),a.createVNode(u,{class:"diff-content"},{default:a.withCtx((()=>[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(d.diffResult,((e,t)=>(a.openBlock(),a.createBlock(f,{key:t,class:["diff-char","diff-"+e.status]},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.char),1)])),_:2},1032,["class"])))),128))])),_:1})];t(s.ssrRenderComponent(u,{class:"diff-label"},{default:a.withCtx(((e,t,s,r)=>{if(!t)return[a.createTextVNode("对比结果：")];t("对比结果：")})),_:1},r,c)),t(s.ssrRenderComponent(u,{class:"diff-content"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(d.diffResult,((e,t)=>(a.openBlock(),a.createBlock(f,{key:t,class:["diff-char","diff-"+e.status]},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.char),1)])),_:2},1032,["class"])))),128))];t("\x3c!--[--\x3e"),s.ssrRenderList(d.diffResult,((e,i)=>{t(s.ssrRenderComponent(f,{key:i,class:["diff-char","diff-"+e.status]},{default:a.withCtx(((t,r,c,i)=>{if(!r)return[a.createTextVNode(a.toDisplayString(e.char),1)];r(`${s.ssrInterpolate(e.char)}`)})),_:2},r,c))})),t("\x3c!--]--\x3e")})),_:1},r,c))})),_:1},r,c)),t(s.ssrRenderComponent(u,{class:"legend"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createVNode(f,{class:"legend-correct"},{default:a.withCtx((()=>[a.createTextVNode("● 正确")])),_:1}),a.createVNode(f,{class:"legend-missing"},{default:a.withCtx((()=>[a.createTextVNode("● 遗漏/错误")])),_:1})];t(s.ssrRenderComponent(f,{class:"legend-correct"},{default:a.withCtx(((e,t,s,r)=>{if(!t)return[a.createTextVNode("● 正确")];t("● 正确")})),_:1},r,c)),t(s.ssrRenderComponent(f,{class:"legend-missing"},{default:a.withCtx(((e,t,s,r)=>{if(!t)return[a.createTextVNode("● 遗漏/错误")];t("● 遗漏/错误")})),_:1},r,c))})),_:1},r,c)),d.recognizedText?t(s.ssrRenderComponent(u,{class:"recognized-area"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createVNode(u,{class:"diff-label"},{default:a.withCtx((()=>[a.createTextVNode("识别文字：")])),_:1}),a.createVNode(f,{class:"recognized-text"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(d.recognizedText),1)])),_:1})];t(s.ssrRenderComponent(u,{class:"diff-label"},{default:a.withCtx(((e,t,s,r)=>{if(!t)return[a.createTextVNode("识别文字：")];t("识别文字：")})),_:1},r,c)),t(s.ssrRenderComponent(f,{class:"recognized-text"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createTextVNode(a.toDisplayString(d.recognizedText),1)];t(`${s.ssrInterpolate(d.recognizedText)}`)})),_:1},r,c))})),_:1},r,c)):t("\x3c!----\x3e"),t(s.ssrRenderComponent(u,{class:"action-area"},{default:a.withCtx(((e,t,r,c)=>{if(!t)return[a.createVNode(x,{type:"primary",class:"btn",onClick:n.goReciteAgain},{default:a.withCtx((()=>[a.createTextVNode(" 再背一次 ")])),_:1},8,["onClick"]),a.createVNode(x,{class:"btn btn-secondary",onClick:n.goHistory},{default:a.withCtx((()=>[a.createTextVNode(" 查看历史 ")])),_:1},8,["onClick"])];t(s.ssrRenderComponent(x,{type:"primary",class:"btn",onClick:n.goReciteAgain},{default:a.withCtx(((e,t,s,r)=>{if(!t)return[a.createTextVNode(" 再背一次 ")];t(" 再背一次 ")})),_:1},r,c)),t(s.ssrRenderComponent(x,{class:"btn btn-secondary",onClick:n.goHistory},{default:a.withCtx(((e,t,s,r)=>{if(!t)return[a.createTextVNode(" 查看历史 ")];t(" 查看历史 ")})),_:1},r,c))})),_:1},r,c))})),_:1},c))}],["__scopeId","data-v-3a9db650"]]);exports.default=l;
