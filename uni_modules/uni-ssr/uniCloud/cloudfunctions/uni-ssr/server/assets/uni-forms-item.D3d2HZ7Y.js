"use strict";const e=require("@dcloudio/uni-h5"),t=require("vue"),r=require("./_plugin-vue_export-helper.BDcHAK_d.js"),i={name:"uniFormsItem",options:{virtualHost:!0},provide(){return{uniFormItem:this}},inject:{form:{from:"uniForm",default:null}},props:{rules:{type:Array,default:()=>null},name:{type:[String,Array],default:""},required:{type:Boolean,default:!1},label:{type:String,default:""},labelWidth:{type:[String,Number],default:""},labelAlign:{type:String,default:""},errorMessage:{type:[String,Boolean],default:""},leftIcon:String,iconColor:{type:String,default:"#606266"}},data:()=>({errMsg:"",userRules:null,localLabelAlign:"left",localLabelWidth:"70px",localLabelPos:"left",border:!1,isFirstBorder:!1}),computed:{msg(){return this.errorMessage||this.errMsg}},watch:{"form.formRules"(e){this.init()},"form.labelWidth"(e){this.localLabelWidth=this._labelWidthUnit(e)},"form.labelPosition"(e){this.localLabelPos=this._labelPosition()},"form.labelAlign"(e){}},created(){this.init(!0),this.name&&this.form&&this.$watch((()=>this.form._getDataValue(this.name,this.form.localData)),((e,t)=>{if(!this.form._isEqual(e,t)){const t=this.itemSetValue(e);this.onFieldChange(t,!1)}}),{immediate:!1})},unmounted(){this.__isUnmounted=!0,this.unInit()},methods:{setRules(e=null){this.userRules=e,this.init(!1)},setValue(){},async onFieldChange(t,r=!0){const{formData:i,localData:s,errShowType:l,validateCheck:o,validateTrigger:a,_isRequiredField:n,_realName:u}=this.form,d=u(this.name);t||(t=this.form.formData[d]);const h=this.itemRules.rules&&this.itemRules.rules.length;if(!this.validator||!h||0===h)return;const m=n(this.itemRules.rules||[]);let f=null;return"bind"===a||r?(f=await this.validator.validateUpdate({[d]:t},i),m||void 0!==t&&""!==t||(f=null),f&&f.errorMessage?("undertext"===l&&(this.errMsg=f?f.errorMessage:""),"toast"===l&&e.showToast({title:f.errorMessage||"校验错误",icon:"none"}),"modal"===l&&e.showModal({title:"提示",content:f.errorMessage||"校验错误"})):this.errMsg="",o(f||null)):this.errMsg="",f||null},init(e=!1){const{validator:t,formRules:r,childrens:i,formData:s,localData:l,_realName:o,labelWidth:a,_getDataValue:n,_setDataValue:u}=this.form||{};if(this.localLabelAlign=this._justifyContent(),this.localLabelWidth=this._labelWidthUnit(a),this.localLabelPos=this._labelPosition(),this.form&&e&&i.push(this),!t||!r)return;this.form.isFirstBorder||(this.form.isFirstBorder=!0,this.isFirstBorder=!0),this.group&&(this.group.isFirstBorder||(this.group.isFirstBorder=!0,this.isFirstBorder=!0)),this.border=this.form.border;const d=o(this.name),h=this.userRules||this.rules;"object"==typeof r&&h&&(r[d]={rules:h},t.updateSchema(r));const m=r[d]||{};this.itemRules=m,this.validator=t,this.itemSetValue(n(this.name,l))},unInit(){if(this.form){const{childrens:e,formData:t,_realName:r}=this.form;e.forEach(((e,i)=>{e===this&&(this.form.childrens.splice(i,1),delete t[r(e.name)])}))}},itemSetValue(e){const t=this.form._realName(this.name),r=this.itemRules.rules||[],i=this.form._getValue(t,e,r);return this.form._setDataValue(t,this.form.formData,i),i},clearValidate(){this.errMsg=""},_isRequired(){return this.required},_justifyContent(){if(this.form){const{labelAlign:e}=this.form;let t=this.labelAlign?this.labelAlign:e;if("left"===t)return"flex-start";if("center"===t)return"center";if("right"===t)return"flex-end"}return"flex-start"},_labelWidthUnit(e){return this.num2px(this.labelWidth?this.labelWidth:e||(this.label?70:"auto"))},_labelPosition(){return this.form&&this.form.labelPosition||"left"},isTrigger:(e,t,r)=>"submit"!==e&&e?"bind":void 0===e?"bind"!==t?t?"submit":""===r?"bind":"submit":"bind":"submit",num2px:e=>"number"==typeof e?`${e}px`:e}};const s=i.setup;i.setup=(e,r)=>{const i=t.useSSRContext();return(i.modules||(i.modules=new Set)).add("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.vue"),s?s(e,r):void 0};const l=r._export_sfc(i,[["ssrRender",function(i,s,l,o,a,n,u,d){const h=e.View,m=e.Text;s(r.ssrRenderComponent(h,t.mergeProps({class:["uni-forms-item",["is-direction-"+u.localLabelPos,u.border?"uni-forms-item--border":"",u.border&&u.isFirstBorder?"is-first-border":""]]},o),{default:t.withCtx(((e,s,l,o)=>{if(!s)return[t.renderSlot(i.$slots,"label",{},(()=>[t.createVNode(h,{class:["uni-forms-item__label",{"no-label":!a.label&&!a.required}],style:{width:u.localLabelWidth,justifyContent:u.localLabelAlign}},{default:t.withCtx((()=>[a.required?(t.openBlock(),t.createBlock(m,{key:0,class:"is-required"},{default:t.withCtx((()=>[t.createTextVNode("*")])),_:1})):t.createCommentVNode("",!0),t.createVNode(m,null,{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(a.label),1)])),_:1})])),_:1},8,["class","style"])]),!0),t.createVNode(h,{class:"uni-forms-item__content"},{default:t.withCtx((()=>[t.renderSlot(i.$slots,"default",{},void 0,!0),t.createVNode(h,{class:["uni-forms-item__error",{"msg--active":d.msg}]},{default:t.withCtx((()=>[t.createVNode(m,null,{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(d.msg),1)])),_:1})])),_:1},8,["class"])])),_:3})];r.ssrRenderSlot(i.$slots,"label",{},(()=>{s(r.ssrRenderComponent(h,{class:["uni-forms-item__label",{"no-label":!a.label&&!a.required}],style:{width:u.localLabelWidth,justifyContent:u.localLabelAlign}},{default:t.withCtx(((e,i,s,l)=>{if(!i)return[a.required?(t.openBlock(),t.createBlock(m,{key:0,class:"is-required"},{default:t.withCtx((()=>[t.createTextVNode("*")])),_:1})):t.createCommentVNode("",!0),t.createVNode(m,null,{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(a.label),1)])),_:1})];a.required?i(r.ssrRenderComponent(m,{class:"is-required"},{default:t.withCtx(((e,r,i,s)=>{if(!r)return[t.createTextVNode("*")];r("*")})),_:1},s,l)):i("\x3c!----\x3e"),i(r.ssrRenderComponent(m,null,{default:t.withCtx(((e,i,s,l)=>{if(!i)return[t.createTextVNode(t.toDisplayString(a.label),1)];i(`${r.ssrInterpolate(a.label)}`)})),_:1},s,l))})),_:1},l,o))}),s,l,o),s(r.ssrRenderComponent(h,{class:"uni-forms-item__content"},{default:t.withCtx(((e,s,l,o)=>{if(!s)return[t.renderSlot(i.$slots,"default",{},void 0,!0),t.createVNode(h,{class:["uni-forms-item__error",{"msg--active":d.msg}]},{default:t.withCtx((()=>[t.createVNode(m,null,{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(d.msg),1)])),_:1})])),_:1},8,["class"])];r.ssrRenderSlot(i.$slots,"default",{},null,s,l,o),s(r.ssrRenderComponent(h,{class:["uni-forms-item__error",{"msg--active":d.msg}]},{default:t.withCtx(((e,i,s,l)=>{if(!i)return[t.createVNode(m,null,{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(d.msg),1)])),_:1})];i(r.ssrRenderComponent(m,null,{default:t.withCtx(((e,i,s,l)=>{if(!i)return[t.createTextVNode(t.toDisplayString(d.msg),1)];i(`${r.ssrInterpolate(d.msg)}`)})),_:1},s,l))})),_:1},l,o))})),_:3},l,o))})),_:3},l))}],["__scopeId","data-v-41a2b37f"]]);exports.__easycom_5=l;
