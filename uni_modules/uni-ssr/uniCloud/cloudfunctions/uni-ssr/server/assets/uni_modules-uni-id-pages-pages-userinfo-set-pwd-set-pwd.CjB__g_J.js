"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("@dcloudio/uni-h5"),o=require("@dcloudio/uni-cloud"),t=require("./uni-match-media.-lgn3PGo.js"),s=require("vue"),a=require("@dcloudio/uni-app"),r=require("./uni-forms.CJ4dDWzJ.js"),n=require("./uni-forms-item.D3d2HZ7Y.js"),d=require("./uni-easyinput.C_oEcPLw.js"),l=require("./uni-id-pages-sms-form.BmxwzBZ8.js"),u=require("./uni-popup-captcha.aJ30TQep.js"),i=require("./password.BqUPu9Pe.js"),c=require("./store.Cv4WGu-a.js"),p=require("../entry-server.js"),m=require("./_plugin-vue_export-helper.BDcHAK_d.js");require("./uni-icons.DF9TZjrB.js"),require("./uni-captcha.5CORWJZL.js"),require("./uni-popup.B_u0Fe_N.js"),require("vue-i18n"),require("@vue/server-renderer"),require("@dcloudio/uni-shared"),require("@vue/shared");const w=o.importObject("uni-id-co",{customUI:!0}),f={name:"set-pwd.vue",data:()=>({uniIdRedirectUrl:"",loginType:"",logo:"/static/logo.png",focusNewPassword:!1,focusNewPassword2:!1,allowSkip:!1,formData:{code:"",captcha:"",newPassword:"",newPassword2:""},rules:i.passwordMod.getPwdRules("newPassword","newPassword2")}),computed:{userInfo:()=>c.store.userInfo},onReady(){this.$refs.form.setRules(this.rules)},onLoad(e){var o;this.uniIdRedirectUrl=e.uniIdRedirectUrl,this.loginType=e.loginType,p.config$1.setPasswordAfterLogin&&(null==(o=p.config$1.setPasswordAfterLogin)?void 0:o.allowSkip)&&(this.allowSkip=!0)},methods:{submit(){if(!/^\d{6}$/.test(this.formData.code))return this.$refs.smsCode.focusSmsCodeInput=!0,e.showToast({title:"验证码格式不正确",icon:"none"});this.$refs.form.validate().then((o=>{w.setPwd({password:this.formData.newPassword,code:this.formData.code,captcha:this.formData.captcha}).then((o=>{e.showModal({content:"密码设置成功",showCancel:!1,success:()=>{c.mutations.loginBack({uniIdRedirectUrl:this.uniIdRedirectUrl,loginType:this.loginType})}})})).catch((o=>{e.showModal({content:o.message,showCancel:!1})}))})).catch((e=>{"uni-id-captcha-required"==e.errCode?this.$refs.popup.open():console.log(e.errMsg)})).finally((e=>{this.formData.captcha=""}))},skip(){c.mutations.loginBack({uniIdRedirectUrl:this.uniIdRedirectUrl})}}};const V=f.setup;f.setup=(e,o)=>{const t=s.useSSRContext();return(t.modules||(t.modules=new Set)).add("uni_modules/uni-id-pages/pages/userinfo/set-pwd/set-pwd.vue"),V?V(e,o):void 0};const h=m._export_sfc(f,[["ssrRender",function(o,i,c,p,w,f,V,h){const C=e.View,x=a.resolveEasycom(s.resolveDynamicComponent("uni-match-media"),t.__easycom_1),N=e.Image,y=e.Text,_=a.resolveEasycom(s.resolveDynamicComponent("uni-forms"),r.__easycom_4),P=a.resolveEasycom(s.resolveDynamicComponent("uni-forms-item"),n.__easycom_5),b=a.resolveEasycom(s.resolveDynamicComponent("uni-easyinput"),d.__easycom_6),k=a.resolveEasycom(s.resolveDynamicComponent("uni-id-pages-sms-form"),l.__easycom_7),D=e.Button,g=a.resolveEasycom(s.resolveDynamicComponent("uni-popup-captcha"),u.__easycom_9);i(m.ssrRenderComponent(C,s.mergeProps({class:"uni-content"},p),{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createVNode(x,{"min-width":690},{default:s.withCtx((()=>[s.createVNode(C,{class:"login-logo"},{default:s.withCtx((()=>[s.createVNode(N,{src:V.logo},null,8,["src"])])),_:1}),s.createVNode(y,{class:"title title-box"},{default:s.withCtx((()=>[s.createTextVNode("设置密码")])),_:1})])),_:1}),s.createVNode(_,{class:"set-password-form",ref:"form",value:V.formData,"err-show-type":"toast"},{default:s.withCtx((()=>[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("输入密码")])),_:1}),s.createVNode(P,{name:"newPassword"},{default:s.withCtx((()=>[s.createVNode(b,{focus:V.focusNewPassword,onBlur:e=>V.focusNewPassword=!1,class:"input-box",type:"password",inputBorder:!1,modelValue:V.formData.newPassword,"onUpdate:modelValue":e=>V.formData.newPassword=e,placeholder:"请输入密码"},null,8,["focus","onBlur","modelValue","onUpdate:modelValue"])])),_:1}),s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("再次输入密码")])),_:1}),s.createVNode(P,{name:"newPassword2"},{default:s.withCtx((()=>[s.createVNode(b,{focus:V.focusNewPassword2,onBlur:e=>V.focusNewPassword2=!1,class:"input-box",type:"password",inputBorder:!1,modelValue:V.formData.newPassword2,"onUpdate:modelValue":e=>V.formData.newPassword2=e,placeholder:"请再次输入新密码"},null,8,["focus","onBlur","modelValue","onUpdate:modelValue"])])),_:1}),s.createVNode(k,{modelValue:V.formData.code,"onUpdate:modelValue":e=>V.formData.code=e,type:"set-pwd-by-sms",ref:"smsCode",phone:h.userInfo.mobile},null,8,["modelValue","onUpdate:modelValue","phone"]),s.createVNode(C,{class:"link-box"},{default:s.withCtx((()=>[s.createVNode(D,{class:"uni-btn send-btn",type:"primary",onClick:h.submit},{default:s.withCtx((()=>[s.createTextVNode("确认")])),_:1},8,["onClick"]),V.allowSkip?(s.openBlock(),s.createBlock(D,{key:0,class:"uni-btn send-btn",type:"default",onClick:h.skip},{default:s.withCtx((()=>[s.createTextVNode("跳过")])),_:1},8,["onClick"])):s.createCommentVNode("",!0)])),_:1})])),_:1},8,["value"]),s.createVNode(g,{onConfirm:h.submit,modelValue:V.formData.captcha,"onUpdate:modelValue":e=>V.formData.captcha=e,scene:"set-pwd-by-sms",ref:"popup"},null,8,["onConfirm","modelValue","onUpdate:modelValue"])];o(m.ssrRenderComponent(x,{"min-width":690},{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createVNode(C,{class:"login-logo"},{default:s.withCtx((()=>[s.createVNode(N,{src:V.logo},null,8,["src"])])),_:1}),s.createVNode(y,{class:"title title-box"},{default:s.withCtx((()=>[s.createTextVNode("设置密码")])),_:1})];o(m.ssrRenderComponent(C,{class:"login-logo"},{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createVNode(N,{src:V.logo},null,8,["src"])];o(m.ssrRenderComponent(N,{src:V.logo},null,t,a))})),_:1},t,a)),o(m.ssrRenderComponent(y,{class:"title title-box"},{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createTextVNode("设置密码")];o("设置密码")})),_:1},t,a))})),_:1},t,a)),o(m.ssrRenderComponent(_,{class:"set-password-form",ref:"form",value:V.formData,"err-show-type":"toast"},{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("输入密码")])),_:1}),s.createVNode(P,{name:"newPassword"},{default:s.withCtx((()=>[s.createVNode(b,{focus:V.focusNewPassword,onBlur:e=>V.focusNewPassword=!1,class:"input-box",type:"password",inputBorder:!1,modelValue:V.formData.newPassword,"onUpdate:modelValue":e=>V.formData.newPassword=e,placeholder:"请输入密码"},null,8,["focus","onBlur","modelValue","onUpdate:modelValue"])])),_:1}),s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("再次输入密码")])),_:1}),s.createVNode(P,{name:"newPassword2"},{default:s.withCtx((()=>[s.createVNode(b,{focus:V.focusNewPassword2,onBlur:e=>V.focusNewPassword2=!1,class:"input-box",type:"password",inputBorder:!1,modelValue:V.formData.newPassword2,"onUpdate:modelValue":e=>V.formData.newPassword2=e,placeholder:"请再次输入新密码"},null,8,["focus","onBlur","modelValue","onUpdate:modelValue"])])),_:1}),s.createVNode(k,{modelValue:V.formData.code,"onUpdate:modelValue":e=>V.formData.code=e,type:"set-pwd-by-sms",ref:"smsCode",phone:h.userInfo.mobile},null,8,["modelValue","onUpdate:modelValue","phone"]),s.createVNode(C,{class:"link-box"},{default:s.withCtx((()=>[s.createVNode(D,{class:"uni-btn send-btn",type:"primary",onClick:h.submit},{default:s.withCtx((()=>[s.createTextVNode("确认")])),_:1},8,["onClick"]),V.allowSkip?(s.openBlock(),s.createBlock(D,{key:0,class:"uni-btn send-btn",type:"default",onClick:h.skip},{default:s.withCtx((()=>[s.createTextVNode("跳过")])),_:1},8,["onClick"])):s.createCommentVNode("",!0)])),_:1})];o(m.ssrRenderComponent(y,{class:"tip"},{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createTextVNode("输入密码")];o("输入密码")})),_:1},t,a)),o(m.ssrRenderComponent(P,{name:"newPassword"},{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createVNode(b,{focus:V.focusNewPassword,onBlur:e=>V.focusNewPassword=!1,class:"input-box",type:"password",inputBorder:!1,modelValue:V.formData.newPassword,"onUpdate:modelValue":e=>V.formData.newPassword=e,placeholder:"请输入密码"},null,8,["focus","onBlur","modelValue","onUpdate:modelValue"])];o(m.ssrRenderComponent(b,{focus:V.focusNewPassword,onBlur:e=>V.focusNewPassword=!1,class:"input-box",type:"password",inputBorder:!1,modelValue:V.formData.newPassword,"onUpdate:modelValue":e=>V.formData.newPassword=e,placeholder:"请输入密码"},null,t,a))})),_:1},t,a)),o(m.ssrRenderComponent(y,{class:"tip"},{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createTextVNode("再次输入密码")];o("再次输入密码")})),_:1},t,a)),o(m.ssrRenderComponent(P,{name:"newPassword2"},{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createVNode(b,{focus:V.focusNewPassword2,onBlur:e=>V.focusNewPassword2=!1,class:"input-box",type:"password",inputBorder:!1,modelValue:V.formData.newPassword2,"onUpdate:modelValue":e=>V.formData.newPassword2=e,placeholder:"请再次输入新密码"},null,8,["focus","onBlur","modelValue","onUpdate:modelValue"])];o(m.ssrRenderComponent(b,{focus:V.focusNewPassword2,onBlur:e=>V.focusNewPassword2=!1,class:"input-box",type:"password",inputBorder:!1,modelValue:V.formData.newPassword2,"onUpdate:modelValue":e=>V.formData.newPassword2=e,placeholder:"请再次输入新密码"},null,t,a))})),_:1},t,a)),o(m.ssrRenderComponent(k,{modelValue:V.formData.code,"onUpdate:modelValue":e=>V.formData.code=e,type:"set-pwd-by-sms",ref:"smsCode",phone:h.userInfo.mobile},null,t,a)),o(m.ssrRenderComponent(C,{class:"link-box"},{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createVNode(D,{class:"uni-btn send-btn",type:"primary",onClick:h.submit},{default:s.withCtx((()=>[s.createTextVNode("确认")])),_:1},8,["onClick"]),V.allowSkip?(s.openBlock(),s.createBlock(D,{key:0,class:"uni-btn send-btn",type:"default",onClick:h.skip},{default:s.withCtx((()=>[s.createTextVNode("跳过")])),_:1},8,["onClick"])):s.createCommentVNode("",!0)];o(m.ssrRenderComponent(D,{class:"uni-btn send-btn",type:"primary",onClick:h.submit},{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createTextVNode("确认")];o("确认")})),_:1},t,a)),V.allowSkip?o(m.ssrRenderComponent(D,{class:"uni-btn send-btn",type:"default",onClick:h.skip},{default:s.withCtx(((e,o,t,a)=>{if(!o)return[s.createTextVNode("跳过")];o("跳过")})),_:1},t,a)):o("\x3c!----\x3e")})),_:1},t,a))})),_:1},t,a)),o(m.ssrRenderComponent(g,{onConfirm:h.submit,modelValue:V.formData.captcha,"onUpdate:modelValue":e=>V.formData.captcha=e,scene:"set-pwd-by-sms",ref:"popup"},null,t,a))})),_:1},c))}],["__scopeId","data-v-f34b7681"]]);exports.default=h;
