"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("@dcloudio/uni-h5"),t=require("@dcloudio/uni-cloud"),a=require("vue"),i=require("./_plugin-vue_export-helper.BDcHAK_d.js");require("@vue/shared");const o={data:()=>({list:[],loading:!1,page:1,total:0,expandedId:"",deletingId:""}),onShow(){this.page=1,this.loadData()},onPullDownRefresh(){this.page=1,this.loadData().then((()=>e.stopPullDownRefresh()))},onReachBottom(){this.list.length<this.total&&(this.page++,this.loadData(!0))},methods:{async loadData(a=!1){this.loading=!0;try{const e=await t.callFunction({name:"recite-record",data:{action:"list",data:{page:this.page,pageSize:20}}}),i=e&&e.result||{};if(0!==i.code||!i.data)throw new Error(i.msg||"加载失败");const{list:o,total:r}=i.data;this.list=a?[...this.list,...o]:o,this.total=r}catch(i){e.showToast({title:i&&i.message||"加载失败",icon:"none"})}finally{this.loading=!1}},toggleDetail(e){this.expandedId=this.expandedId===e?"":e},async confirmDelete(t){if(!t||!t._id||this.deletingId)return;(await new Promise((t=>{e.showModal({title:"删除记录",content:"确定删除这条背诵记录吗？删除后不可恢复。",confirmText:"删除",confirmColor:"#f5222d",success:t,fail:()=>t({confirm:!1})})}))).confirm&&this.deleteRecord(t._id)},async deleteRecord(a){this.deletingId=a;try{const i=await t.callFunction({name:"recite-record",data:{action:"delete",data:{id:a}}}),o=i&&i.result||{};if(0!==o.code)throw new Error(o.msg||"删除失败");this.list=this.list.filter((e=>e._id!==a)),this.total=Math.max(0,this.total-1),this.expandedId===a&&(this.expandedId=""),e.showToast({title:"删除成功",icon:"success"})}catch(i){e.showToast({title:i&&i.message||"删除失败",icon:"none"})}finally{this.deletingId=""}},formatTime(e){if(!e)return"";const t=new Date(e),a=e=>String(e).padStart(2,"0");return`${t.getFullYear()}-${a(t.getMonth()+1)}-${a(t.getDate())} ${a(t.getHours())}:${a(t.getMinutes())}`}}};const r=o.setup;o.setup=(e,t)=>{const i=a.useSSRContext();return(i.modules||(i.modules=new Set)).add("pages/ancient/history.vue"),r?r(e,t):void 0};const c=i._export_sfc(o,[["ssrRender",function(t,o,r,c,l,d,s,n){const u=e.View,x=e.Text;o(i.ssrRenderComponent(u,a.mergeProps({class:"container"},c),{default:a.withCtx(((e,t,o,r)=>{if(!t)return[s.list.length>0?(a.openBlock(),a.createBlock(u,{key:0,class:"list"},{default:a.withCtx((()=>[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(s.list,(e=>(a.openBlock(),a.createBlock(u,{class:"list-item",key:e._id,onClick:t=>n.toggleDetail(e._id)},{default:a.withCtx((()=>[a.createVNode(u,{class:"item-header"},{default:a.withCtx((()=>[a.createVNode(x,{class:"item-title"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.text_title),1)])),_:2},1024),a.createVNode(u,{class:"item-right"},{default:a.withCtx((()=>[a.createVNode(x,{class:"item-accuracy"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.accuracy||0)+"%",1)])),_:2},1024),a.createVNode(x,{class:"item-delete",onClick:a.withModifiers((t=>n.confirmDelete(e)),["stop"])},{default:a.withCtx((()=>[a.createTextVNode("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),a.createVNode(u,{class:"item-meta"},{default:a.withCtx((()=>[a.createVNode(x,null,{default:a.withCtx((()=>[a.createTextVNode("提示 "+a.toDisplayString(e.hint_count)+" 次",1)])),_:2},1024),a.createVNode(x,{class:"item-time"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(n.formatTime(e.created_at)),1)])),_:2},1024)])),_:2},1024),s.expandedId===e._id?(a.openBlock(),a.createBlock(u,{key:0,class:"item-detail"},{default:a.withCtx((()=>[a.createVNode(u,{class:"diff-content"},{default:a.withCtx((()=>[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(e.diff_result||[],((e,t)=>(a.openBlock(),a.createBlock(x,{key:t,class:["diff-char","diff-"+e.status]},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.char),1)])),_:2},1032,["class"])))),128))])),_:2},1024),e.recognized_text?(a.openBlock(),a.createBlock(u,{key:0,class:"recognized"},{default:a.withCtx((()=>[a.createVNode(x,{class:"recognized-label"},{default:a.withCtx((()=>[a.createTextVNode("识别文字：")])),_:1}),a.createVNode(x,{class:"recognized-text"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.recognized_text),1)])),_:2},1024)])),_:2},1024)):a.createCommentVNode("",!0)])),_:2},1024)):a.createCommentVNode("",!0)])),_:2},1032,["onClick"])))),128))])),_:1})):s.loading?a.createCommentVNode("",!0):(a.openBlock(),a.createBlock(u,{key:1,class:"empty"},{default:a.withCtx((()=>[a.createVNode(x,null,{default:a.withCtx((()=>[a.createTextVNode("暂无背诵记录")])),_:1})])),_:1})),s.loading?(a.openBlock(),a.createBlock(u,{key:2,class:"loading"},{default:a.withCtx((()=>[a.createVNode(x,null,{default:a.withCtx((()=>[a.createTextVNode("加载中...")])),_:1})])),_:1})):a.createCommentVNode("",!0)];s.list.length>0?t(i.ssrRenderComponent(u,{class:"list"},{default:a.withCtx(((e,t,o,r)=>{if(!t)return[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(s.list,(e=>(a.openBlock(),a.createBlock(u,{class:"list-item",key:e._id,onClick:t=>n.toggleDetail(e._id)},{default:a.withCtx((()=>[a.createVNode(u,{class:"item-header"},{default:a.withCtx((()=>[a.createVNode(x,{class:"item-title"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.text_title),1)])),_:2},1024),a.createVNode(u,{class:"item-right"},{default:a.withCtx((()=>[a.createVNode(x,{class:"item-accuracy"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.accuracy||0)+"%",1)])),_:2},1024),a.createVNode(x,{class:"item-delete",onClick:a.withModifiers((t=>n.confirmDelete(e)),["stop"])},{default:a.withCtx((()=>[a.createTextVNode("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),a.createVNode(u,{class:"item-meta"},{default:a.withCtx((()=>[a.createVNode(x,null,{default:a.withCtx((()=>[a.createTextVNode("提示 "+a.toDisplayString(e.hint_count)+" 次",1)])),_:2},1024),a.createVNode(x,{class:"item-time"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(n.formatTime(e.created_at)),1)])),_:2},1024)])),_:2},1024),s.expandedId===e._id?(a.openBlock(),a.createBlock(u,{key:0,class:"item-detail"},{default:a.withCtx((()=>[a.createVNode(u,{class:"diff-content"},{default:a.withCtx((()=>[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(e.diff_result||[],((e,t)=>(a.openBlock(),a.createBlock(x,{key:t,class:["diff-char","diff-"+e.status]},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.char),1)])),_:2},1032,["class"])))),128))])),_:2},1024),e.recognized_text?(a.openBlock(),a.createBlock(u,{key:0,class:"recognized"},{default:a.withCtx((()=>[a.createVNode(x,{class:"recognized-label"},{default:a.withCtx((()=>[a.createTextVNode("识别文字：")])),_:1}),a.createVNode(x,{class:"recognized-text"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.recognized_text),1)])),_:2},1024)])),_:2},1024)):a.createCommentVNode("",!0)])),_:2},1024)):a.createCommentVNode("",!0)])),_:2},1032,["onClick"])))),128))];t("\x3c!--[--\x3e"),i.ssrRenderList(s.list,(e=>{t(i.ssrRenderComponent(u,{class:"list-item",key:e._id,onClick:t=>n.toggleDetail(e._id)},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createVNode(u,{class:"item-header"},{default:a.withCtx((()=>[a.createVNode(x,{class:"item-title"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.text_title),1)])),_:2},1024),a.createVNode(u,{class:"item-right"},{default:a.withCtx((()=>[a.createVNode(x,{class:"item-accuracy"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.accuracy||0)+"%",1)])),_:2},1024),a.createVNode(x,{class:"item-delete",onClick:a.withModifiers((t=>n.confirmDelete(e)),["stop"])},{default:a.withCtx((()=>[a.createTextVNode("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),a.createVNode(u,{class:"item-meta"},{default:a.withCtx((()=>[a.createVNode(x,null,{default:a.withCtx((()=>[a.createTextVNode("提示 "+a.toDisplayString(e.hint_count)+" 次",1)])),_:2},1024),a.createVNode(x,{class:"item-time"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(n.formatTime(e.created_at)),1)])),_:2},1024)])),_:2},1024),s.expandedId===e._id?(a.openBlock(),a.createBlock(u,{key:0,class:"item-detail"},{default:a.withCtx((()=>[a.createVNode(u,{class:"diff-content"},{default:a.withCtx((()=>[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(e.diff_result||[],((e,t)=>(a.openBlock(),a.createBlock(x,{key:t,class:["diff-char","diff-"+e.status]},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.char),1)])),_:2},1032,["class"])))),128))])),_:2},1024),e.recognized_text?(a.openBlock(),a.createBlock(u,{key:0,class:"recognized"},{default:a.withCtx((()=>[a.createVNode(x,{class:"recognized-label"},{default:a.withCtx((()=>[a.createTextVNode("识别文字：")])),_:1}),a.createVNode(x,{class:"recognized-text"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.recognized_text),1)])),_:2},1024)])),_:2},1024)):a.createCommentVNode("",!0)])),_:2},1024)):a.createCommentVNode("",!0)];o(i.ssrRenderComponent(u,{class:"item-header"},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createVNode(x,{class:"item-title"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.text_title),1)])),_:2},1024),a.createVNode(u,{class:"item-right"},{default:a.withCtx((()=>[a.createVNode(x,{class:"item-accuracy"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.accuracy||0)+"%",1)])),_:2},1024),a.createVNode(x,{class:"item-delete",onClick:a.withModifiers((t=>n.confirmDelete(e)),["stop"])},{default:a.withCtx((()=>[a.createTextVNode("删除")])),_:2},1032,["onClick"])])),_:2},1024)];o(i.ssrRenderComponent(x,{class:"item-title"},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createTextVNode(a.toDisplayString(e.text_title),1)];o(`${i.ssrInterpolate(e.text_title)}`)})),_:2},r,c)),o(i.ssrRenderComponent(u,{class:"item-right"},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createVNode(x,{class:"item-accuracy"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.accuracy||0)+"%",1)])),_:2},1024),a.createVNode(x,{class:"item-delete",onClick:a.withModifiers((t=>n.confirmDelete(e)),["stop"])},{default:a.withCtx((()=>[a.createTextVNode("删除")])),_:2},1032,["onClick"])];o(i.ssrRenderComponent(x,{class:"item-accuracy"},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createTextVNode(a.toDisplayString(e.accuracy||0)+"%",1)];o(`${i.ssrInterpolate(e.accuracy||0)}%`)})),_:2},r,c)),o(i.ssrRenderComponent(x,{class:"item-delete",onClick:t=>n.confirmDelete(e)},{default:a.withCtx(((e,t,i,o)=>{if(!t)return[a.createTextVNode("删除")];t("删除")})),_:2},r,c))})),_:2},r,c))})),_:2},r,c)),o(i.ssrRenderComponent(u,{class:"item-meta"},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createVNode(x,null,{default:a.withCtx((()=>[a.createTextVNode("提示 "+a.toDisplayString(e.hint_count)+" 次",1)])),_:2},1024),a.createVNode(x,{class:"item-time"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(n.formatTime(e.created_at)),1)])),_:2},1024)];o(i.ssrRenderComponent(x,null,{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createTextVNode("提示 "+a.toDisplayString(e.hint_count)+" 次",1)];o(`提示 ${i.ssrInterpolate(e.hint_count)} 次`)})),_:2},r,c)),o(i.ssrRenderComponent(x,{class:"item-time"},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createTextVNode(a.toDisplayString(n.formatTime(e.created_at)),1)];o(`${i.ssrInterpolate(n.formatTime(e.created_at))}`)})),_:2},r,c))})),_:2},r,c)),s.expandedId===e._id?o(i.ssrRenderComponent(u,{class:"item-detail"},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createVNode(u,{class:"diff-content"},{default:a.withCtx((()=>[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(e.diff_result||[],((e,t)=>(a.openBlock(),a.createBlock(x,{key:t,class:["diff-char","diff-"+e.status]},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.char),1)])),_:2},1032,["class"])))),128))])),_:2},1024),e.recognized_text?(a.openBlock(),a.createBlock(u,{key:0,class:"recognized"},{default:a.withCtx((()=>[a.createVNode(x,{class:"recognized-label"},{default:a.withCtx((()=>[a.createTextVNode("识别文字：")])),_:1}),a.createVNode(x,{class:"recognized-text"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.recognized_text),1)])),_:2},1024)])),_:2},1024)):a.createCommentVNode("",!0)];o(i.ssrRenderComponent(u,{class:"diff-content"},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(e.diff_result||[],((e,t)=>(a.openBlock(),a.createBlock(x,{key:t,class:["diff-char","diff-"+e.status]},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.char),1)])),_:2},1032,["class"])))),128))];o("\x3c!--[--\x3e"),i.ssrRenderList(e.diff_result||[],((e,t)=>{o(i.ssrRenderComponent(x,{key:t,class:["diff-char","diff-"+e.status]},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createTextVNode(a.toDisplayString(e.char),1)];o(`${i.ssrInterpolate(e.char)}`)})),_:2},r,c))})),o("\x3c!--]--\x3e")})),_:2},r,c)),e.recognized_text?o(i.ssrRenderComponent(u,{class:"recognized"},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createVNode(x,{class:"recognized-label"},{default:a.withCtx((()=>[a.createTextVNode("识别文字：")])),_:1}),a.createVNode(x,{class:"recognized-text"},{default:a.withCtx((()=>[a.createTextVNode(a.toDisplayString(e.recognized_text),1)])),_:2},1024)];o(i.ssrRenderComponent(x,{class:"recognized-label"},{default:a.withCtx(((e,t,i,o)=>{if(!t)return[a.createTextVNode("识别文字：")];t("识别文字：")})),_:2},r,c)),o(i.ssrRenderComponent(x,{class:"recognized-text"},{default:a.withCtx(((t,o,r,c)=>{if(!o)return[a.createTextVNode(a.toDisplayString(e.recognized_text),1)];o(`${i.ssrInterpolate(e.recognized_text)}`)})),_:2},r,c))})),_:2},r,c)):o("\x3c!----\x3e")})),_:2},r,c)):o("\x3c!----\x3e")})),_:2},o,r))})),t("\x3c!--]--\x3e")})),_:1},o,r)):s.loading?t("\x3c!----\x3e"):t(i.ssrRenderComponent(u,{class:"empty"},{default:a.withCtx(((e,t,o,r)=>{if(!t)return[a.createVNode(x,null,{default:a.withCtx((()=>[a.createTextVNode("暂无背诵记录")])),_:1})];t(i.ssrRenderComponent(x,null,{default:a.withCtx(((e,t,i,o)=>{if(!t)return[a.createTextVNode("暂无背诵记录")];t("暂无背诵记录")})),_:1},o,r))})),_:1},o,r)),s.loading?t(i.ssrRenderComponent(u,{class:"loading"},{default:a.withCtx(((e,t,o,r)=>{if(!t)return[a.createVNode(x,null,{default:a.withCtx((()=>[a.createTextVNode("加载中...")])),_:1})];t(i.ssrRenderComponent(x,null,{default:a.withCtx(((e,t,i,o)=>{if(!t)return[a.createTextVNode("加载中...")];t("加载中...")})),_:1},o,r))})),_:1},o,r)):t("\x3c!----\x3e")})),_:1},r))}],["__scopeId","data-v-dee1b6ae"]]);exports.default=c;
