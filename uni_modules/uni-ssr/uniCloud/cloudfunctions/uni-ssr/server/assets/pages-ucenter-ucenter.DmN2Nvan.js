"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("@dcloudio/uni-h5"),t=require("@dcloudio/uni-cloud"),o=require("./uni-popup.B_u0Fe_N.js"),s=require("vue"),r=require("@dcloudio/uni-app"),a=require("./uni-icons.DF9TZjrB.js"),i=require("./_plugin-vue_export-helper.BDcHAK_d.js"),n=require("./cloud-image.mprnzhV6.js"),l=require("./uni-list-item.DbqdfHei.js"),c=require("./store.Cv4WGu-a.js");require("@vue/shared"),require("../entry-server.js"),require("vue-i18n"),require("@vue/server-renderer"),require("@dcloudio/uni-shared");const d="RewardedVideo",u="FullScreenVideo";const h="csj";class p{constructor(e,t={}){this._isLoad=!1,this._isLoading=!1,this._lastLoadTime=0,this._lastError=null,this._retryCount=0,this._loadCallback=null,this._closeCallback=null,this._errorCallback=null;const o=this._ad=e;o.onLoad((e=>{this._isLoading=!1,this._isLoad=!0,this._lastLoadTime=Date.now(),this.onLoad()})),o.onClose((e=>{this._isLoad=!1,this.onClose(e)})),o.onVerify&&o.onVerify((e=>{})),o.onError((({code:e,message:t})=>{this._isLoading=!1;const o={code:e,errMsg:t};if(-5008!==e){if(this._retryCount<1)return this._retryCount+=1,void this._loadAd();this._lastError=o,this.onError(o)}else this._loadAd()}))}get isExpired(){return 0!==this._lastLoadTime&&Math.abs(Date.now()-this._lastLoadTime)>18e5}get isLoading(){return this._isLoading}getProvider(){return this._ad.getProvider()}load(e,t){this._loadCallback=e,this._errorCallback=t,this._isLoading||(this._isLoad?this.onLoad():(this._retryCount=0,this._loadAd()))}show(e){if(this._closeCallback=e,this._isLoading||!this._isLoad)return;if(null!==this._lastError)return void this.onError(this._lastError);this.getProvider()===h&&this.isExpired?this._loadAd():this._ad.show()}onLoad(e){null!=this._loadCallback&&this._loadCallback()}onClose(e){null!=this._closeCallback&&this._closeCallback({isEnded:e.isEnded})}onError(e){null!=this._errorCallback&&this._errorCallback(e)}destroy(){this._ad.destroy()}_loadAd(){this._isLoad=!1,this._isLoading=!0,this._lastError=null,this._ad.load()}}class g extends p{constructor(e={}){super(plus.ad.createRewardedVideoAd(e),e)}}class f extends p{constructor(e={}){super(plus.ad.createFullScreenVideoAd(e),e)}}const x=new class{constructor(){this._ads={}}load(e,t,o){let s=this._fixOldOptions(e),{adpid:r}=s;r&&!this.isBusy(r)&&this.get(s).load(t,o)}show(t,o,s){let r=this._fixOldOptions(t),{adpid:a}=r;if(a){e.showLoading({mask:!0});var i=this.get(r);i.load((()=>{e.hideLoading(),i.show((e=>{o&&o(e)}))}),(t=>{e.hideLoading(),s&&s(t)}))}}isBusy(e){return this._ads[e]&&this._ads[e].isLoading}get(e){const{adpid:t,singleton:o=!0}=e;return!1===o&&this._ads[t]&&(this._ads[t].destroy(),delete this._ads[t]),delete e.singleton,this._ads[t]||(this._ads[t]=this._createAdInstance(e)),this._ads[t]}_createAdInstance(e){const t=e.adType||d;delete e.adType;let o=null;return t===d?o=new g(e):t===u&&(o=new f(e)),o}_fixOldOptions(e){return"string"==typeof e?{adpid:e}:e}},k="https://gw.shiyuankeji.cn/assets/background-Bu1oXiEy.png",y=t.database().action("signIn").collection("opendb-sign-in");new Date((new Date).toLocaleDateString()).getTime();const m={name:"uni-signIn",data:()=>({total:0,scores:0,weekdays:[1,2,3,4,5,6,7],signInRes:{days:[],n:0}}),mounted(){},methods:{async getSignedInInfo(t="今日已签过"){const o=new Date((new Date).toLocaleDateString()).getTime();let s=await y.where(`'user_id' == $env.uid && 'date' == ${o} && 'isDelete' == false`).get();return s.result.data.length&&(this.signInRes=s.result,this.$refs.popup.open(),e.showToast({title:t,duration:3e3,icon:"none"})),s.result.data},async showRewardedVideoAd(){let t=await this.getSignedInInfo();if(console.log(t),t&&0==t.length){let{_id:t}=e.getStorageSync("userInfo");if(console.log(t,e.getStorageSync("userInfo")),!t)return e.navigateTo({url:"/pages/ucenter/login-page/index/index"});x.show({adpid:1733738477,adType:"RewardedVideo",urlCallback:{userId:t,extra:"uniSignIn"}},(t=>{if(t&&t.isEnded){console.log("onClose "+t.isEnded);let o=0;e.showLoading({mask:!0});let s=setInterval((async r=>{o++,t=await this.getSignedInInfo("签到成功"),(o>2||t.length)&&(t.length||e.showToast({title:"签到失败！",icon:"error",duration:6e3}),clearInterval(s),e.hideLoading())}),2e3)}else console.log("onClose "+t.isEnded),e.showToast({title:"播放中途退出,签到失败！",icon:"error",duration:5e3})}),(t=>{console.log(t),e.showToast({title:t.errMsg,icon:"none"})}))}},async open(){e.showLoading({mask:!0});try{let t=await this.getSignedInInfo();if(t&&0==t.length){let t=await y.add({});console.log(t),e.hideLoading(),this.signInRes=t.result,this.$refs.popup.open(),7==this.signInRes.days.length?e.showToast({title:"你已完成7日连续签到，获得60积分！",icon:"none",duration:5e3}):e.showToast({title:"签到成功,获得10积分！",icon:"none",duration:5e3})}}catch(t){e.hideLoading(),console.error(t)}},closeMe(e){this.$refs.popup.close()}}};const _=m.setup;m.setup=(e,t)=>{const o=s.useSSRContext();return(o.modules||(o.modules=new Set)).add("uni_modules/uni-sign-in/components/uni-sign-in/uni-sign-in.vue"),_?_(e,t):void 0};const C=i._export_sfc(m,[["ssrRender",function(t,n,l,c,d,u,h,p){const g=e.View,f=r.resolveEasycom(s.resolveDynamicComponent("uni-popup"),o.__easycom_0),x=e.Image,y=e.Text,m=r.resolveEasycom(s.resolveDynamicComponent("uni-icons"),a.__easycom_1);n(i.ssrRenderComponent(g,c,{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createVNode(f,{ref:"popup",type:"center"},{default:s.withCtx((()=>[s.createVNode(x,{class:"background-img",src:k,mode:"width"}),s.createVNode(g,{class:"content"},{default:s.withCtx((()=>[s.createVNode(g,{class:"main"},{default:s.withCtx((()=>[s.createVNode(y,{class:"title"},{default:s.withCtx((()=>[s.createTextVNode("今日签到成功")])),_:1}),s.createVNode(y,{class:"total"},{default:s.withCtx((()=>[s.createTextVNode("本轮已签到"+s.toDisplayString(h.signInRes.days.length)+"天",1)])),_:1}),s.createVNode(y,{class:"scores"},{default:s.withCtx((()=>[s.createTextVNode("当前积分："+s.toDisplayString(h.signInRes.score),1)])),_:1})])),_:1}),s.createVNode(g,null,{default:s.withCtx((()=>[s.createVNode(g,{class:"days-box"},{default:s.withCtx((()=>[(s.openBlock(!0),s.createBlock(s.Fragment,null,s.renderList(h.weekdays,((e,t)=>(s.openBlock(),s.createBlock(g,{class:"days",key:t},{default:s.withCtx((()=>[h.signInRes.days.includes(e-1)?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"checkmarkempty"})):(s.openBlock(),s.createBlock(s.Fragment,{key:1},[e<h.signInRes.n?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"closeempty"})):(s.openBlock(),s.createBlock(m,{key:1,class:"icon",type:"checkmarkempty",color:"#FFFFFF"}))],64)),h.signInRes.days.includes(e-1)||e>h.signInRes.n?(s.openBlock(),s.createBlock(y,{key:2,class:["day",{grey:e>h.signInRes.n}]},{default:s.withCtx((()=>[s.createTextVNode("第"+s.toDisplayString(e)+"天",1)])),_:2},1032,["class"])):(s.openBlock(),s.createBlock(y,{key:3,class:"day"},{default:s.withCtx((()=>[s.createTextVNode("缺卡")])),_:1}))])),_:2},1024)))),128))])),_:1}),s.createVNode(g,{class:"tip-box"},{default:s.withCtx((()=>[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("签到一次得10积分")])),_:1}),s.createVNode(g,{class:"row"},{default:s.withCtx((()=>[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("连续签到7天可多得")])),_:1}),s.createVNode(y,{class:"red"},{default:s.withCtx((()=>[s.createTextVNode("50")])),_:1}),s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("积分")])),_:1})])),_:1})])),_:1})])),_:1}),s.createVNode(m,{onClick:p.closeMe,class:"close-icon",type:"closeempty",size:"20",color:"#AAAAAA"},null,8,["onClick"])])),_:1})])),_:1},512)];t(i.ssrRenderComponent(f,{ref:"popup",type:"center"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createVNode(x,{class:"background-img",src:k,mode:"width"}),s.createVNode(g,{class:"content"},{default:s.withCtx((()=>[s.createVNode(g,{class:"main"},{default:s.withCtx((()=>[s.createVNode(y,{class:"title"},{default:s.withCtx((()=>[s.createTextVNode("今日签到成功")])),_:1}),s.createVNode(y,{class:"total"},{default:s.withCtx((()=>[s.createTextVNode("本轮已签到"+s.toDisplayString(h.signInRes.days.length)+"天",1)])),_:1}),s.createVNode(y,{class:"scores"},{default:s.withCtx((()=>[s.createTextVNode("当前积分："+s.toDisplayString(h.signInRes.score),1)])),_:1})])),_:1}),s.createVNode(g,null,{default:s.withCtx((()=>[s.createVNode(g,{class:"days-box"},{default:s.withCtx((()=>[(s.openBlock(!0),s.createBlock(s.Fragment,null,s.renderList(h.weekdays,((e,t)=>(s.openBlock(),s.createBlock(g,{class:"days",key:t},{default:s.withCtx((()=>[h.signInRes.days.includes(e-1)?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"checkmarkempty"})):(s.openBlock(),s.createBlock(s.Fragment,{key:1},[e<h.signInRes.n?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"closeempty"})):(s.openBlock(),s.createBlock(m,{key:1,class:"icon",type:"checkmarkempty",color:"#FFFFFF"}))],64)),h.signInRes.days.includes(e-1)||e>h.signInRes.n?(s.openBlock(),s.createBlock(y,{key:2,class:["day",{grey:e>h.signInRes.n}]},{default:s.withCtx((()=>[s.createTextVNode("第"+s.toDisplayString(e)+"天",1)])),_:2},1032,["class"])):(s.openBlock(),s.createBlock(y,{key:3,class:"day"},{default:s.withCtx((()=>[s.createTextVNode("缺卡")])),_:1}))])),_:2},1024)))),128))])),_:1}),s.createVNode(g,{class:"tip-box"},{default:s.withCtx((()=>[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("签到一次得10积分")])),_:1}),s.createVNode(g,{class:"row"},{default:s.withCtx((()=>[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("连续签到7天可多得")])),_:1}),s.createVNode(y,{class:"red"},{default:s.withCtx((()=>[s.createTextVNode("50")])),_:1}),s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("积分")])),_:1})])),_:1})])),_:1})])),_:1}),s.createVNode(m,{onClick:p.closeMe,class:"close-icon",type:"closeempty",size:"20",color:"#AAAAAA"},null,8,["onClick"])])),_:1})];t(i.ssrRenderComponent(x,{class:"background-img",src:k,mode:"width"},null,o,r)),t(i.ssrRenderComponent(g,{class:"content"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createVNode(g,{class:"main"},{default:s.withCtx((()=>[s.createVNode(y,{class:"title"},{default:s.withCtx((()=>[s.createTextVNode("今日签到成功")])),_:1}),s.createVNode(y,{class:"total"},{default:s.withCtx((()=>[s.createTextVNode("本轮已签到"+s.toDisplayString(h.signInRes.days.length)+"天",1)])),_:1}),s.createVNode(y,{class:"scores"},{default:s.withCtx((()=>[s.createTextVNode("当前积分："+s.toDisplayString(h.signInRes.score),1)])),_:1})])),_:1}),s.createVNode(g,null,{default:s.withCtx((()=>[s.createVNode(g,{class:"days-box"},{default:s.withCtx((()=>[(s.openBlock(!0),s.createBlock(s.Fragment,null,s.renderList(h.weekdays,((e,t)=>(s.openBlock(),s.createBlock(g,{class:"days",key:t},{default:s.withCtx((()=>[h.signInRes.days.includes(e-1)?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"checkmarkempty"})):(s.openBlock(),s.createBlock(s.Fragment,{key:1},[e<h.signInRes.n?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"closeempty"})):(s.openBlock(),s.createBlock(m,{key:1,class:"icon",type:"checkmarkempty",color:"#FFFFFF"}))],64)),h.signInRes.days.includes(e-1)||e>h.signInRes.n?(s.openBlock(),s.createBlock(y,{key:2,class:["day",{grey:e>h.signInRes.n}]},{default:s.withCtx((()=>[s.createTextVNode("第"+s.toDisplayString(e)+"天",1)])),_:2},1032,["class"])):(s.openBlock(),s.createBlock(y,{key:3,class:"day"},{default:s.withCtx((()=>[s.createTextVNode("缺卡")])),_:1}))])),_:2},1024)))),128))])),_:1}),s.createVNode(g,{class:"tip-box"},{default:s.withCtx((()=>[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("签到一次得10积分")])),_:1}),s.createVNode(g,{class:"row"},{default:s.withCtx((()=>[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("连续签到7天可多得")])),_:1}),s.createVNode(y,{class:"red"},{default:s.withCtx((()=>[s.createTextVNode("50")])),_:1}),s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("积分")])),_:1})])),_:1})])),_:1})])),_:1}),s.createVNode(m,{onClick:p.closeMe,class:"close-icon",type:"closeempty",size:"20",color:"#AAAAAA"},null,8,["onClick"])];t(i.ssrRenderComponent(g,{class:"main"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createVNode(y,{class:"title"},{default:s.withCtx((()=>[s.createTextVNode("今日签到成功")])),_:1}),s.createVNode(y,{class:"total"},{default:s.withCtx((()=>[s.createTextVNode("本轮已签到"+s.toDisplayString(h.signInRes.days.length)+"天",1)])),_:1}),s.createVNode(y,{class:"scores"},{default:s.withCtx((()=>[s.createTextVNode("当前积分："+s.toDisplayString(h.signInRes.score),1)])),_:1})];t(i.ssrRenderComponent(y,{class:"title"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createTextVNode("今日签到成功")];t("今日签到成功")})),_:1},o,r)),t(i.ssrRenderComponent(y,{class:"total"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createTextVNode("本轮已签到"+s.toDisplayString(h.signInRes.days.length)+"天",1)];t(`本轮已签到${i.ssrInterpolate(h.signInRes.days.length)}天`)})),_:1},o,r)),t(i.ssrRenderComponent(y,{class:"scores"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createTextVNode("当前积分："+s.toDisplayString(h.signInRes.score),1)];t(`当前积分：${i.ssrInterpolate(h.signInRes.score)}`)})),_:1},o,r))})),_:1},o,r)),t(i.ssrRenderComponent(g,null,{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createVNode(g,{class:"days-box"},{default:s.withCtx((()=>[(s.openBlock(!0),s.createBlock(s.Fragment,null,s.renderList(h.weekdays,((e,t)=>(s.openBlock(),s.createBlock(g,{class:"days",key:t},{default:s.withCtx((()=>[h.signInRes.days.includes(e-1)?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"checkmarkempty"})):(s.openBlock(),s.createBlock(s.Fragment,{key:1},[e<h.signInRes.n?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"closeempty"})):(s.openBlock(),s.createBlock(m,{key:1,class:"icon",type:"checkmarkempty",color:"#FFFFFF"}))],64)),h.signInRes.days.includes(e-1)||e>h.signInRes.n?(s.openBlock(),s.createBlock(y,{key:2,class:["day",{grey:e>h.signInRes.n}]},{default:s.withCtx((()=>[s.createTextVNode("第"+s.toDisplayString(e)+"天",1)])),_:2},1032,["class"])):(s.openBlock(),s.createBlock(y,{key:3,class:"day"},{default:s.withCtx((()=>[s.createTextVNode("缺卡")])),_:1}))])),_:2},1024)))),128))])),_:1}),s.createVNode(g,{class:"tip-box"},{default:s.withCtx((()=>[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("签到一次得10积分")])),_:1}),s.createVNode(g,{class:"row"},{default:s.withCtx((()=>[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("连续签到7天可多得")])),_:1}),s.createVNode(y,{class:"red"},{default:s.withCtx((()=>[s.createTextVNode("50")])),_:1}),s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("积分")])),_:1})])),_:1})])),_:1})];t(i.ssrRenderComponent(g,{class:"days-box"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[(s.openBlock(!0),s.createBlock(s.Fragment,null,s.renderList(h.weekdays,((e,t)=>(s.openBlock(),s.createBlock(g,{class:"days",key:t},{default:s.withCtx((()=>[h.signInRes.days.includes(e-1)?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"checkmarkempty"})):(s.openBlock(),s.createBlock(s.Fragment,{key:1},[e<h.signInRes.n?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"closeempty"})):(s.openBlock(),s.createBlock(m,{key:1,class:"icon",type:"checkmarkempty",color:"#FFFFFF"}))],64)),h.signInRes.days.includes(e-1)||e>h.signInRes.n?(s.openBlock(),s.createBlock(y,{key:2,class:["day",{grey:e>h.signInRes.n}]},{default:s.withCtx((()=>[s.createTextVNode("第"+s.toDisplayString(e)+"天",1)])),_:2},1032,["class"])):(s.openBlock(),s.createBlock(y,{key:3,class:"day"},{default:s.withCtx((()=>[s.createTextVNode("缺卡")])),_:1}))])),_:2},1024)))),128))];t("\x3c!--[--\x3e"),i.ssrRenderList(h.weekdays,((e,a)=>{t(i.ssrRenderComponent(g,{class:"days",key:a},{default:s.withCtx(((t,o,r,a)=>{if(!o)return[h.signInRes.days.includes(e-1)?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"checkmarkempty"})):(s.openBlock(),s.createBlock(s.Fragment,{key:1},[e<h.signInRes.n?(s.openBlock(),s.createBlock(m,{key:0,class:"icon active",color:"#FFFFFF",type:"closeempty"})):(s.openBlock(),s.createBlock(m,{key:1,class:"icon",type:"checkmarkempty",color:"#FFFFFF"}))],64)),h.signInRes.days.includes(e-1)||e>h.signInRes.n?(s.openBlock(),s.createBlock(y,{key:2,class:["day",{grey:e>h.signInRes.n}]},{default:s.withCtx((()=>[s.createTextVNode("第"+s.toDisplayString(e)+"天",1)])),_:2},1032,["class"])):(s.openBlock(),s.createBlock(y,{key:3,class:"day"},{default:s.withCtx((()=>[s.createTextVNode("缺卡")])),_:1}))];h.signInRes.days.includes(e-1)?o(i.ssrRenderComponent(m,{class:"icon active",color:"#FFFFFF",type:"checkmarkempty"},null,r,a)):(o("\x3c!--[--\x3e"),e<h.signInRes.n?o(i.ssrRenderComponent(m,{class:"icon active",color:"#FFFFFF",type:"closeempty"},null,r,a)):o(i.ssrRenderComponent(m,{class:"icon",type:"checkmarkempty",color:"#FFFFFF"},null,r,a)),o("\x3c!--]--\x3e")),h.signInRes.days.includes(e-1)||e>h.signInRes.n?o(i.ssrRenderComponent(y,{class:["day",{grey:e>h.signInRes.n}]},{default:s.withCtx(((t,o,r,a)=>{if(!o)return[s.createTextVNode("第"+s.toDisplayString(e)+"天",1)];o(`第${i.ssrInterpolate(e)}天`)})),_:2},r,a)):o(i.ssrRenderComponent(y,{class:"day"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createTextVNode("缺卡")];t("缺卡")})),_:2},r,a))})),_:2},o,r))})),t("\x3c!--]--\x3e")})),_:1},o,r)),t(i.ssrRenderComponent(g,{class:"tip-box"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("签到一次得10积分")])),_:1}),s.createVNode(g,{class:"row"},{default:s.withCtx((()=>[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("连续签到7天可多得")])),_:1}),s.createVNode(y,{class:"red"},{default:s.withCtx((()=>[s.createTextVNode("50")])),_:1}),s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("积分")])),_:1})])),_:1})];t(i.ssrRenderComponent(y,{class:"tip"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createTextVNode("签到一次得10积分")];t("签到一次得10积分")})),_:1},o,r)),t(i.ssrRenderComponent(g,{class:"row"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("连续签到7天可多得")])),_:1}),s.createVNode(y,{class:"red"},{default:s.withCtx((()=>[s.createTextVNode("50")])),_:1}),s.createVNode(y,{class:"tip"},{default:s.withCtx((()=>[s.createTextVNode("积分")])),_:1})];t(i.ssrRenderComponent(y,{class:"tip"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createTextVNode("连续签到7天可多得")];t("连续签到7天可多得")})),_:1},o,r)),t(i.ssrRenderComponent(y,{class:"red"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createTextVNode("50")];t("50")})),_:1},o,r)),t(i.ssrRenderComponent(y,{class:"tip"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createTextVNode("积分")];t("积分")})),_:1},o,r))})),_:1},o,r))})),_:1},o,r))})),_:1},o,r)),t(i.ssrRenderComponent(m,{onClick:p.closeMe,class:"close-icon",type:"closeempty",size:"20",color:"#AAAAAA"},null,o,r))})),_:1},o,r))})),_:1},o,r))})),_:1},l))}],["__scopeId","data-v-26f1750b"]]),w={name:"UniGrid",emits:["change"],props:{column:{type:Number,default:3},showBorder:{type:Boolean,default:!0},borderColor:{type:String,default:"#D2D2D2"},square:{type:Boolean,default:!0},highlight:{type:Boolean,default:!0}},provide(){return{grid:this}},data:()=>({elId:`Uni_${Math.ceil(1e6*Math.random()).toString(36)}`,width:0}),created(){this.children=[]},mounted(){this.$nextTick((()=>{this.init()}))},methods:{init(){setTimeout((()=>{this._getSize((e=>{this.children.forEach(((t,o)=>{t.width=e}))}))}),50)},change(e){this.$emit("change",e)},_getSize(t){e.createSelectorQuery().in(this).select(`#${this.elId}`).boundingClientRect().exec((e=>{this.width=parseInt((e[0].width-1)/this.column)+"px",t(this.width)}))}}};const V=w.setup;w.setup=(e,t)=>{const o=s.useSSRContext();return(o.modules||(o.modules=new Set)).add("uni_modules/uni-grid/components/uni-grid/uni-grid.vue"),V?V(e,t):void 0};const N=i._export_sfc(w,[["ssrRender",function(t,o,r,a,n,l,c,d){const u=e.View;o(i.ssrRenderComponent(u,s.mergeProps({class:"uni-grid-wrap"},a),{default:s.withCtx(((e,o,r,a)=>{if(!o)return[s.createVNode(u,{id:c.elId,ref:"uni-grid",class:["uni-grid",{"uni-grid--border":n.showBorder}],style:{"border-left-color":n.borderColor}},{default:s.withCtx((()=>[s.renderSlot(t.$slots,"default",{},void 0,!0)])),_:3},8,["id","class","style"])];o(i.ssrRenderComponent(u,{id:c.elId,ref:"uni-grid",class:["uni-grid",{"uni-grid--border":n.showBorder}],style:{"border-left-color":n.borderColor}},{default:s.withCtx(((e,o,r,a)=>{if(!o)return[s.renderSlot(t.$slots,"default",{},void 0,!0)];i.ssrRenderSlot(t.$slots,"default",{},null,o,r,a)})),_:3},r,a))})),_:3},r))}],["__scopeId","data-v-551d9659"]]),B={name:"UniGridItem",inject:["grid"],props:{index:{type:Number,default:0}},data:()=>({column:0,showBorder:!0,square:!0,highlight:!0,left:0,top:0,openNum:2,width:0,borderColor:"#e5e5e5"}),created(){this.column=this.grid.column,this.showBorder=this.grid.showBorder,this.square=this.grid.square,this.highlight=this.grid.highlight,this.top=0===this.hor?this.grid.hor:this.hor,this.left=0===this.ver?this.grid.ver:this.ver,this.borderColor=this.grid.borderColor,this.grid.children.push(this),this.width=this.grid.width},beforeDestroy(){this.grid.children.forEach(((e,t)=>{e===this&&this.grid.children.splice(t,1)}))},methods:{_onClick(){this.grid.change({detail:{index:this.index}})}}};const F=B.setup;B.setup=(e,t)=>{const o=s.useSSRContext();return(o.modules||(o.modules=new Set)).add("uni_modules/uni-grid/components/uni-grid-item/uni-grid-item.vue"),F?F(e,t):void 0};const I=i._export_sfc(B,[["ssrRender",function(t,o,r,a,n,l,c,d){const u=e.View;c.width?o(i.ssrRenderComponent(u,s.mergeProps({style:"width:"+c.width+";"+(c.square?"height:"+c.width:""),class:"uni-grid-item"},a),{default:s.withCtx(((e,o,r,a)=>{if(!o)return[s.createVNode(u,{class:[{"uni-grid-item--border":c.showBorder,"uni-grid-item--border-top":c.showBorder&&n.index<c.column,"uni-highlight":c.highlight},"uni-grid-item__box"],style:{"border-right-color":c.borderColor,"border-bottom-color":c.borderColor,"border-top-color":c.borderColor},onClick:d._onClick},{default:s.withCtx((()=>[s.renderSlot(t.$slots,"default",{},void 0,!0)])),_:3},8,["class","style","onClick"])];o(i.ssrRenderComponent(u,{class:[{"uni-grid-item--border":c.showBorder,"uni-grid-item--border-top":c.showBorder&&n.index<c.column,"uni-highlight":c.highlight},"uni-grid-item__box"],style:{"border-right-color":c.borderColor,"border-bottom-color":c.borderColor,"border-top-color":c.borderColor},onClick:d._onClick},{default:s.withCtx(((e,o,r,a)=>{if(!o)return[s.renderSlot(t.$slots,"default",{},void 0,!0)];i.ssrRenderSlot(t.$slots,"default",{},null,o,r,a)})),_:3},r,a))})),_:3},r)):o("\x3c!----\x3e")}],["__scopeId","data-v-1f1eb9ce"]]);const b=t.database(),R={data(){return{gridList:[{label:"背诵时间",value:"0秒"},{label:"背诵文章数",value:"0"},{label:"背诵次数",value:"0"},{label:"背诵准确率",value:"0%"}],ucenterList:[[{title:this.$t("mine.signIn"),event:"signIn",icon:"compose"}],[{title:this.$t("mine.feedback"),to:"/uni_modules/uni-feedback/pages/opendb-feedback/opendb-feedback",icon:"help"},{title:this.$t("mine.settings"),to:"/pages/ucenter/settings/settings",icon:"gear"}]],listStyles:{height:"150rpx",width:"150rpx",border:{color:"#eee",width:"1px",style:"solid",radius:"100%"}}}},onLoad(){},onShow(){this.loadReciteStats()},computed:{userInfo:()=>c.store.userInfo,hasLogin:()=>c.store.hasLogin,appConfig:()=>e.getApp().globalData.config},methods:{toSettings(){e.navigateTo({url:"/pages/ucenter/settings/settings"})},signIn(){this.$refs.signIn.open()},signInByAd(){this.$refs.signIn.showRewardedVideoAd()},ucenterListClick(e){!e.to&&e.event&&this[e.event]()},async checkVersion(){let t=await new Promise(((e,t)=>{t({message:"请在App中使用"})}));console.log(t),t.result.code>0||e.showToast({title:t.result.message,icon:"none"})},toUserInfo(){e.navigateTo({url:"/uni_modules/uni-id-pages/pages/userinfo/userinfo"})},tapGrid(e){},async loadReciteStats(){if(this.hasLogin)try{const e=100;let o=1,s=0;const r=[];for(;;){const a=await t.callFunction({name:"recite-record",data:{action:"list",data:{page:o,pageSize:e}}}),i=a&&a.result||{};if(0!==i.code||!i.data)throw new Error(i.msg||"加载背诵统计失败");const n=i.data.list||[];if(s=i.data.total||0,r.push(...n),r.length>=s||0===n.length)break;o++}const a=new Set;let i=0,n=0,l=0;r.forEach((e=>{e&&e.text_id&&a.add(e.text_id);const t=Number(e.duration_seconds||e.duration||e.recite_duration||e.reciteDuration||0);Number.isFinite(t)&&t>0&&(i+=Math.floor(t));const o=Number(e.accuracy);Number.isFinite(o)&&(n+=o,l++)}));const c=l>0?(n/l).toFixed(1):"0";this.gridList=[{label:"背诵时间",value:this.formatDuration(i)},{label:"背诵文章数",value:String(a.size)},{label:"背诵次数",value:String(r.length)},{label:"背诵准确率",value:`${c}%`}]}catch(e){console.error("加载背诵统计失败",e)}else this.gridList=[{label:"总背诵时间",value:"0秒"},{label:"总背诵文章数",value:"0"},{label:"总背诵次数",value:"0"},{label:"总背诵准确率",value:"0%"}]},formatDuration(e){const t=Number(e)||0;if(t<=0)return"0秒";const o=Math.floor(t/3600),s=Math.floor(t%3600/60),r=t%60;return o>0?`${o}小时${s}分`:s>0?`${s}分${r}秒`:`${r}秒`},gotoMarket(){},getScore(){if(!this.userInfo)return e.showToast({title:this.$t("mine.checkScore"),icon:"none"});e.showLoading({mask:!0}),b.collection("uni-id-scores").where('"user_id" == $env.uid').field("score,balance").orderBy("create_date","desc").limit(1).get().then((t=>{console.log(t);const o=t.result.data[0];let s="";s=o?this.$t("mine.currentScore")+o.balance:this.$t("mine.noScore"),e.showToast({title:s,icon:"none"})})).finally((()=>{e.hideLoading()}))},async share(){let{result:t}=await b.collection("uni-id-users").where("'_id' == $cloudEnv_uid").field("my_invite_code").get(),o=t.data[0].my_invite_code;if(!o)return e.showToast({title:"请检查uni-config-center中uni-id配置，是否已启用 autoSetInviteCode",icon:"none"});console.log({myInviteCode:o}),this.appConfig.about}}};const T=R.setup;R.setup=(e,t)=>{const o=s.useSSRContext();return(o.modules||(o.modules=new Set)).add("pages/ucenter/ucenter.vue"),T?T(e,t):void 0};const v=i._export_sfc(R,[["ssrRender",function(t,o,c,d,u,h,p,g){const f=e.View,x=r.resolveEasycom(s.resolveDynamicComponent("uni-sign-in"),C),k=r.resolveEasycom(s.resolveDynamicComponent("cloud-image"),n.__easycom_1),y=r.resolveEasycom(s.resolveDynamicComponent("uni-icons"),a.__easycom_1),m=e.Text,_=r.resolveEasycom(s.resolveDynamicComponent("uni-grid"),N),w=r.resolveEasycom(s.resolveDynamicComponent("uni-grid-item"),I),V=r.resolveEasycom(s.resolveDynamicComponent("uni-list"),l.__easycom_1),B=r.resolveEasycom(s.resolveDynamicComponent("uni-list-item"),l.__easycom_2);o(i.ssrRenderComponent(f,s.mergeProps({class:"center"},d),{default:s.withCtx(((e,o,r,a)=>{if(!o)return[s.createVNode(x,{ref:"signIn"},null,512),s.createVNode(f,{class:"userInfo",onClickCapture:g.toUserInfo},{default:s.withCtx((()=>[g.hasLogin&&g.userInfo.avatar_file&&g.userInfo.avatar_file.url?(s.openBlock(),s.createBlock(k,{key:0,width:"150rpx",height:"150rpx",src:g.userInfo.avatar_file.url},null,8,["src"])):(s.openBlock(),s.createBlock(f,{key:1,class:"defaultAvatarUrl"},{default:s.withCtx((()=>[s.createVNode(y,{color:"#ffffff",size:"50",type:"person-filled"})])),_:1})),s.createVNode(f,{class:"logo-title"},{default:s.withCtx((()=>[g.hasLogin?(s.openBlock(),s.createBlock(m,{key:0,class:"uer-name"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(g.userInfo.nickname||g.userInfo.username||g.userInfo.mobile),1)])),_:1})):(s.openBlock(),s.createBlock(m,{key:1,class:"uer-name"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(t.$t("mine.notLogged")),1)])),_:1}))])),_:1})])),_:1},8,["onClickCapture"]),s.createVNode(_,{class:"grid",column:4,showBorder:!1,square:!0},{default:s.withCtx((()=>[(s.openBlock(!0),s.createBlock(s.Fragment,null,s.renderList(p.gridList,((e,t)=>(s.openBlock(),s.createBlock(w,{class:"item",onClick:e=>g.tapGrid(t),key:t},{default:s.withCtx((()=>[s.createVNode(m,{class:"stat-value"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(e.value),1)])),_:2},1024),s.createVNode(m,{class:"stat-label"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(e.label),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),(s.openBlock(!0),s.createBlock(s.Fragment,null,s.renderList(p.ucenterList,((e,t)=>(s.openBlock(),s.createBlock(V,{class:"center-list",key:t},{default:s.withCtx((()=>[(s.openBlock(!0),s.createBlock(s.Fragment,null,s.renderList(e,((e,t)=>(s.openBlock(),s.createBlock(B,{title:e.title,link:"",rightText:e.rightText,key:t,clickable:!0,to:e.to,onClick:t=>g.ucenterListClick(e),"show-extra-icon":!0,extraIcon:{type:e.icon,color:"#999"}},{footer:s.withCtx((()=>[e.showBadge?(s.openBlock(),s.createBlock(f,{key:0,class:"item-footer"},{default:s.withCtx((()=>[s.createVNode(m,{class:"item-footer-text"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(e.rightText),1)])),_:2},1024),s.createVNode(f,{class:"item-footer-badge"})])),_:2},1024)):s.createCommentVNode("",!0)])),_:2},1032,["title","rightText","to","onClick","extraIcon"])))),128))])),_:2},1024)))),128))];o(i.ssrRenderComponent(x,{ref:"signIn"},null,r,a)),o(i.ssrRenderComponent(f,{class:"userInfo",onClick:g.toUserInfo},{default:s.withCtx(((e,o,r,a)=>{if(!o)return[g.hasLogin&&g.userInfo.avatar_file&&g.userInfo.avatar_file.url?(s.openBlock(),s.createBlock(k,{key:0,width:"150rpx",height:"150rpx",src:g.userInfo.avatar_file.url},null,8,["src"])):(s.openBlock(),s.createBlock(f,{key:1,class:"defaultAvatarUrl"},{default:s.withCtx((()=>[s.createVNode(y,{color:"#ffffff",size:"50",type:"person-filled"})])),_:1})),s.createVNode(f,{class:"logo-title"},{default:s.withCtx((()=>[g.hasLogin?(s.openBlock(),s.createBlock(m,{key:0,class:"uer-name"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(g.userInfo.nickname||g.userInfo.username||g.userInfo.mobile),1)])),_:1})):(s.openBlock(),s.createBlock(m,{key:1,class:"uer-name"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(t.$t("mine.notLogged")),1)])),_:1}))])),_:1})];g.hasLogin&&g.userInfo.avatar_file&&g.userInfo.avatar_file.url?o(i.ssrRenderComponent(k,{width:"150rpx",height:"150rpx",src:g.userInfo.avatar_file.url},null,r,a)):o(i.ssrRenderComponent(f,{class:"defaultAvatarUrl"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createVNode(y,{color:"#ffffff",size:"50",type:"person-filled"})];t(i.ssrRenderComponent(y,{color:"#ffffff",size:"50",type:"person-filled"},null,o,r))})),_:1},r,a)),o(i.ssrRenderComponent(f,{class:"logo-title"},{default:s.withCtx(((e,o,r,a)=>{if(!o)return[g.hasLogin?(s.openBlock(),s.createBlock(m,{key:0,class:"uer-name"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(g.userInfo.nickname||g.userInfo.username||g.userInfo.mobile),1)])),_:1})):(s.openBlock(),s.createBlock(m,{key:1,class:"uer-name"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(t.$t("mine.notLogged")),1)])),_:1}))];g.hasLogin?o(i.ssrRenderComponent(m,{class:"uer-name"},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[s.createTextVNode(s.toDisplayString(g.userInfo.nickname||g.userInfo.username||g.userInfo.mobile),1)];t(`${i.ssrInterpolate(g.userInfo.nickname||g.userInfo.username||g.userInfo.mobile)}`)})),_:1},r,a)):o(i.ssrRenderComponent(m,{class:"uer-name"},{default:s.withCtx(((e,o,r,a)=>{if(!o)return[s.createTextVNode(s.toDisplayString(t.$t("mine.notLogged")),1)];o(`${i.ssrInterpolate(t.$t("mine.notLogged"))}`)})),_:1},r,a))})),_:1},r,a))})),_:1},r,a)),o(i.ssrRenderComponent(_,{class:"grid",column:4,showBorder:!1,square:!0},{default:s.withCtx(((e,t,o,r)=>{if(!t)return[(s.openBlock(!0),s.createBlock(s.Fragment,null,s.renderList(p.gridList,((e,t)=>(s.openBlock(),s.createBlock(w,{class:"item",onClick:e=>g.tapGrid(t),key:t},{default:s.withCtx((()=>[s.createVNode(m,{class:"stat-value"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(e.value),1)])),_:2},1024),s.createVNode(m,{class:"stat-label"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(e.label),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))];t("\x3c!--[--\x3e"),i.ssrRenderList(p.gridList,((e,a)=>{t(i.ssrRenderComponent(w,{class:"item",onClick:e=>g.tapGrid(a),key:a},{default:s.withCtx(((t,o,r,a)=>{if(!o)return[s.createVNode(m,{class:"stat-value"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(e.value),1)])),_:2},1024),s.createVNode(m,{class:"stat-label"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(e.label),1)])),_:2},1024)];o(i.ssrRenderComponent(m,{class:"stat-value"},{default:s.withCtx(((t,o,r,a)=>{if(!o)return[s.createTextVNode(s.toDisplayString(e.value),1)];o(`${i.ssrInterpolate(e.value)}`)})),_:2},r,a)),o(i.ssrRenderComponent(m,{class:"stat-label"},{default:s.withCtx(((t,o,r,a)=>{if(!o)return[s.createTextVNode(s.toDisplayString(e.label),1)];o(`${i.ssrInterpolate(e.label)}`)})),_:2},r,a))})),_:2},o,r))})),t("\x3c!--]--\x3e")})),_:1},r,a)),o("\x3c!--[--\x3e"),i.ssrRenderList(p.ucenterList,((e,t)=>{o(i.ssrRenderComponent(V,{class:"center-list",key:t},{default:s.withCtx(((t,o,r,a)=>{if(!o)return[(s.openBlock(!0),s.createBlock(s.Fragment,null,s.renderList(e,((e,t)=>(s.openBlock(),s.createBlock(B,{title:e.title,link:"",rightText:e.rightText,key:t,clickable:!0,to:e.to,onClick:t=>g.ucenterListClick(e),"show-extra-icon":!0,extraIcon:{type:e.icon,color:"#999"}},{footer:s.withCtx((()=>[e.showBadge?(s.openBlock(),s.createBlock(f,{key:0,class:"item-footer"},{default:s.withCtx((()=>[s.createVNode(m,{class:"item-footer-text"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(e.rightText),1)])),_:2},1024),s.createVNode(f,{class:"item-footer-badge"})])),_:2},1024)):s.createCommentVNode("",!0)])),_:2},1032,["title","rightText","to","onClick","extraIcon"])))),128))];o("\x3c!--[--\x3e"),i.ssrRenderList(e,((e,t)=>{o(i.ssrRenderComponent(B,{title:e.title,link:"",rightText:e.rightText,key:t,clickable:!0,to:e.to,onClick:t=>g.ucenterListClick(e),"show-extra-icon":!0,extraIcon:{type:e.icon,color:"#999"}},{footer:s.withCtx(((t,o,r,a)=>{if(!o)return[e.showBadge?(s.openBlock(),s.createBlock(f,{key:0,class:"item-footer"},{default:s.withCtx((()=>[s.createVNode(m,{class:"item-footer-text"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(e.rightText),1)])),_:2},1024),s.createVNode(f,{class:"item-footer-badge"})])),_:2},1024)):s.createCommentVNode("",!0)];e.showBadge?o(i.ssrRenderComponent(f,{class:"item-footer"},{default:s.withCtx(((t,o,r,a)=>{if(!o)return[s.createVNode(m,{class:"item-footer-text"},{default:s.withCtx((()=>[s.createTextVNode(s.toDisplayString(e.rightText),1)])),_:2},1024),s.createVNode(f,{class:"item-footer-badge"})];o(i.ssrRenderComponent(m,{class:"item-footer-text"},{default:s.withCtx(((t,o,r,a)=>{if(!o)return[s.createTextVNode(s.toDisplayString(e.rightText),1)];o(`${i.ssrInterpolate(e.rightText)}`)})),_:2},r,a)),o(i.ssrRenderComponent(f,{class:"item-footer-badge"},null,r,a))})),_:2},r,a)):o("\x3c!----\x3e")})),_:2},r,a))})),o("\x3c!--]--\x3e")})),_:2},r,a))})),o("\x3c!--]--\x3e")})),_:1},c))}],["__scopeId","data-v-81cf6d26"]]);exports.default=v;
