"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("@dcloudio/uni-h5"),t=require("@dcloudio/uni-cloud"),o=require("./cloud-image.mprnzhV6.js"),i=require("vue"),n=require("@dcloudio/uni-app"),s=require("./uni-icons.DF9TZjrB.js"),a=require("./store.Cv4WGu-a.js"),l=require("./_plugin-vue_export-helper.BDcHAK_d.js"),r=require("./uni-list-item.DbqdfHei.js"),c=require("./uni-popup.B_u0Fe_N.js"),u=require("./uni-popup-dialog.BiXp_EP-.js");require("../entry-server.js"),require("vue-i18n"),require("@vue/server-renderer"),require("@dcloudio/uni-shared"),require("@vue/shared"),require("@dcloudio/uni-i18n");const d={data:()=>({isPC:!1}),props:{width:{type:String,default:()=>"50px"},height:{type:String,default:()=>"50px"},border:{type:Boolean,default:()=>!1}},async mounted(){const t=e.getSystemInfoSync().platform;this.isPC=!["ios","android"].includes(t)||"harmonyos"===t},computed:{hasLogin:()=>a.store.hasLogin,userInfo:()=>a.store.userInfo,avatar_file:()=>a.store.userInfo.avatar_file},methods:{setAvatarFile(e){a.mutations.updateUserInfo({avatar_file:e})},async bindchooseavatar(o){let i=o.detail.avatarUrl,n={extname:i.split(".")[i.split(".").length-1],name:"",url:""},s=this.userInfo._id+""+Date.now();n.name=s;try{e.showLoading({title:"更新中",mask:!0});let{fileID:o}=await t.uploadFile({filePath:i,cloudPath:s,fileType:"image"});n.url=o,e.hideLoading()}catch(a){console.error(a)}console.log("avatar_file",n),this.setAvatarFile(n)},uploadAvatarImg(o){if(!this.hasLogin)return e.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"});const i={quality:100,width:600,height:600,resize:!0};e.chooseImage({count:1,crop:i,success:async o=>{let n=o.tempFiles[0],s={extname:n.name.split(".")[n.name.split(".").length-1]},a=o.tempFilePaths[0];this.isPC||(a=await new Promise((t=>{e.navigateTo({url:"/uni_modules/uni-id-pages/pages/userinfo/cropImage/cropImage?path="+a+`&options=${JSON.stringify(i)}`,animationType:"fade-in",events:{success:e=>{t(e)}},complete(e){console.log(e)}})})));let l=this.userInfo._id+""+Date.now();s.name=l,e.showLoading({title:"更新中",mask:!0});let{fileID:r}=await t.uploadFile({filePath:a,cloudPath:l,fileType:"image"});s.url=r,e.hideLoading(),this.setAvatarFile(s)}})}}};const p=d.setup;d.setup=(e,t)=>{const o=i.useSSRContext();return(o.modules||(o.modules=new Set)).add("uni_modules/uni-id-pages/components/uni-id-pages-avatar/uni-id-pages-avatar.vue"),p?p(e,t):void 0};const m=l._export_sfc(d,[["ssrRender",function(t,a,r,c,u,d,p,m){const h=e.Button,g=n.resolveEasycom(i.resolveDynamicComponent("cloud-image"),o.__easycom_1),f=n.resolveEasycom(i.resolveDynamicComponent("uni-icons"),s.__easycom_1);a(l.ssrRenderComponent(h,i.mergeProps({"open-type":"chooseAvatar",onChooseavatar:m.bindchooseavatar,onClick:m.uploadAvatarImg,class:["box",{showBorder:u.border}],style:{width:u.width,height:u.height,lineHeight:u.height}},c),{default:i.withCtx(((e,t,o,n)=>{if(!t)return[m.avatar_file?(i.openBlock(),i.createBlock(g,{key:0,src:m.avatar_file.url,width:u.width,height:u.height},null,8,["src","width","height"])):(i.openBlock(),i.createBlock(f,{key:1,style:{width:u.width,height:u.height,lineHeight:u.height},class:"chooseAvatar",type:"plusempty",size:"30",color:"#dddddd"},null,8,["style"]))];m.avatar_file?t(l.ssrRenderComponent(g,{src:m.avatar_file.url,width:u.width,height:u.height},null,o,n)):t(l.ssrRenderComponent(f,{style:{width:u.width,height:u.height,lineHeight:u.height},class:"chooseAvatar",type:"plusempty",size:"30",color:"#dddddd"},null,o,n))})),_:1},r))}],["__scopeId","data-v-6c473d63"]]);t.database().collection("uni-id-users");const h=t.importObject("uni-id-co"),g={emits:["success"],computed:{},data:()=>({}),methods:{beforeGetphonenumber:async()=>await new Promise(((o,i)=>{e.showLoading({mask:!0}),wx.checkSession({success(){o(),e.hideLoading()},fail(){e.login({success({code:n}){t.importObject("uni-id-co",{customUI:!0}).loginByWeixin({code:n}).then((e=>{o()})).catch((e=>{console.log(e),i()})).finally((t=>{e.hideLoading()}))},fail:e=>{console.error(e),i()}})}})})),async bindMobileByMpWeixin(e){"getPhoneNumber:ok"==e.detail.errMsg?(await this.beforeGetphonenumber(),h.bindMobileByMpWeixin(e.detail).then((e=>{this.$emit("success")})).finally((e=>{this.closeMe()}))):this.closeMe()},async open(){this.$refs.popup.open()},closeMe(e){this.$refs.popup.close()}}};const f=g.setup;g.setup=(e,t)=>{const o=i.useSSRContext();return(o.modules||(o.modules=new Set)).add("uni_modules/uni-id-pages/components/uni-id-pages-bind-mobile/uni-id-pages-bind-mobile.vue"),f?f(e,t):void 0};const C=l._export_sfc(g,[["ssrRender",function(t,o,s,a,r,u,d,p){const m=n.resolveEasycom(i.resolveDynamicComponent("uni-popup"),c.__easycom_0),h=e.View,g=e.Text,f=e.Button;o(l.ssrRenderComponent(m,i.mergeProps({ref:"popup",type:"bottom"},a),{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createVNode(h,{class:"box"},{default:i.withCtx((()=>[i.createVNode(g,{class:"headBox"},{default:i.withCtx((()=>[i.createTextVNode("绑定资料")])),_:1}),i.createVNode(g,{class:"tip"},{default:i.withCtx((()=>[i.createTextVNode("将一键获取你的手机号码绑定你的个人资料")])),_:1}),i.createVNode(h,{class:"btnBox"},{default:i.withCtx((()=>[i.createVNode(g,{onClick:p.closeMe,class:"close"},{default:i.withCtx((()=>[i.createTextVNode("关闭")])),_:1},8,["onClick"]),i.createVNode(f,{class:"agree uni-btn",type:"primary","open-type":"getPhoneNumber",onGetphonenumber:p.bindMobileByMpWeixin},{default:i.withCtx((()=>[i.createTextVNode("获取")])),_:1},8,["onGetphonenumber"])])),_:1})])),_:1})];t(l.ssrRenderComponent(h,{class:"box"},{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createVNode(g,{class:"headBox"},{default:i.withCtx((()=>[i.createTextVNode("绑定资料")])),_:1}),i.createVNode(g,{class:"tip"},{default:i.withCtx((()=>[i.createTextVNode("将一键获取你的手机号码绑定你的个人资料")])),_:1}),i.createVNode(h,{class:"btnBox"},{default:i.withCtx((()=>[i.createVNode(g,{onClick:p.closeMe,class:"close"},{default:i.withCtx((()=>[i.createTextVNode("关闭")])),_:1},8,["onClick"]),i.createVNode(f,{class:"agree uni-btn",type:"primary","open-type":"getPhoneNumber",onGetphonenumber:p.bindMobileByMpWeixin},{default:i.withCtx((()=>[i.createTextVNode("获取")])),_:1},8,["onGetphonenumber"])])),_:1})];t(l.ssrRenderComponent(g,{class:"headBox"},{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createTextVNode("绑定资料")];t("绑定资料")})),_:1},o,n)),t(l.ssrRenderComponent(g,{class:"tip"},{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createTextVNode("将一键获取你的手机号码绑定你的个人资料")];t("将一键获取你的手机号码绑定你的个人资料")})),_:1},o,n)),t(l.ssrRenderComponent(h,{class:"btnBox"},{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createVNode(g,{onClick:p.closeMe,class:"close"},{default:i.withCtx((()=>[i.createTextVNode("关闭")])),_:1},8,["onClick"]),i.createVNode(f,{class:"agree uni-btn",type:"primary","open-type":"getPhoneNumber",onGetphonenumber:p.bindMobileByMpWeixin},{default:i.withCtx((()=>[i.createTextVNode("获取")])),_:1},8,["onGetphonenumber"])];t(l.ssrRenderComponent(g,{onClick:p.closeMe,class:"close"},{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createTextVNode("关闭")];t("关闭")})),_:1},o,n)),t(l.ssrRenderComponent(f,{class:"agree uni-btn",type:"primary","open-type":"getPhoneNumber",onGetphonenumber:p.bindMobileByMpWeixin},{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createTextVNode("获取")];t("获取")})),_:1},o,n))})),_:1},o,n))})),_:1},o,n))})),_:1},s))}],["__scopeId","data-v-1edc5089"]]),y=t.importObject("uni-id-co"),x={computed:{userInfo:()=>a.store.userInfo,realNameStatus(){return this.userInfo.realNameAuth?this.userInfo.realNameAuth.authStatus:0}},data:()=>({univerifyStyle:{authButton:{title:"本机号码一键绑定"},otherLoginButton:{title:"其他号码绑定"}},hasPwd:!1,showLoginManage:!1,setNicknameIng:!1}),async onShow(){this.univerifyStyle.authButton.title="本机号码一键绑定",this.univerifyStyle.otherLoginButton.title="其他号码绑定"},async onLoad(e){e.showLoginManage&&(this.showLoginManage=!0);let t=await y.getAccountInfo();this.hasPwd=t.isPasswordSet},methods:{login(){e.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd",complete:e=>{}})},logout(){a.mutations.logout()},bindMobileSuccess(){a.mutations.updateUserInfo()},changePassword(){e.navigateTo({url:"/uni_modules/uni-id-pages/pages/userinfo/change_pwd/change_pwd",complete:e=>{}})},bindMobile(){this.bindMobileBySmsCode()},univerify(){e.login({provider:"univerify",univerifyStyle:this.univerifyStyle,success:async e=>{y.bindMobileByUniverify(e.authResult).then((e=>{a.mutations.updateUserInfo()})).catch((e=>{console.log(e)})).finally((e=>{uni.closeAuthView()}))},fail:e=>{console.log(e),"30002"!=e.code&&"30001"!=e.code||this.bindMobileBySmsCode()}})},bindMobileBySmsCode(){e.navigateTo({url:"./bind-mobile/bind-mobile"})},setNickname(e){e?(a.mutations.updateUserInfo({nickname:e}),this.setNicknameIng=!1,this.$refs.dialog.close()):this.$refs.dialog.open()},deactivate(){e.navigateTo({url:"/uni_modules/uni-id-pages/pages/userinfo/deactivate/deactivate"})},async bindThirdAccount(o){const i=t.importObject("uni-id-co"),n={weixin:"wx_openid",alipay:"ali_openid",apple:"apple_openid",qq:"qq_openid"}[o.toLowerCase()];this.userInfo[n]?(await i["unbind"+o](),await a.mutations.updateUserInfo()):e.login({provider:o.toLowerCase(),onlyAuthorize:!0,success:async t=>{const n=await i["bind"+o]({code:t.code});n.errCode&&e.showToast({title:n.errMsg||"绑定失败",duration:3e3}),await a.mutations.updateUserInfo()},fail:async t=>{console.log(t),e.hideLoading()}})},realNameVerify(){e.navigateTo({url:"/uni_modules/uni-id-pages/pages/userinfo/realname-verify/realname-verify"})}}};const w=x.setup;x.setup=(e,t)=>{const o=i.useSSRContext();return(o.modules||(o.modules=new Set)).add("uni_modules/uni-id-pages/pages/userinfo/userinfo.vue"),w?w(e,t):void 0};const k=l._export_sfc(x,[["ssrRender",function(t,o,s,a,d,p,h,g){const f=e.View,y=n.resolveEasycom(i.resolveDynamicComponent("uni-id-pages-avatar"),m),x=n.resolveEasycom(i.resolveDynamicComponent("uni-list"),r.__easycom_1),w=n.resolveEasycom(i.resolveDynamicComponent("uni-list-item"),r.__easycom_2),k=n.resolveEasycom(i.resolveDynamicComponent("uni-popup"),c.__easycom_0),_=n.resolveEasycom(i.resolveDynamicComponent("uni-popup-dialog"),u.__easycom_6),v=n.resolveEasycom(i.resolveDynamicComponent("uni-id-pages-bind-mobile"),C),b=e.Button;o(l.ssrRenderComponent(f,i.mergeProps({class:"uni-content"},a),{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createVNode(f,{class:"avatar"},{default:i.withCtx((()=>[i.createVNode(y,{width:"260rpx",height:"260rpx"})])),_:1}),i.createVNode(x,null,{default:i.withCtx((()=>[i.createVNode(w,{class:"item",onClick:e=>g.setNickname(""),title:"昵称",rightText:g.userInfo.nickname||"未设置",link:""},null,8,["onClick","rightText"]),i.createVNode(w,{class:"item",onClick:g.bindMobile,title:"手机号",rightText:g.userInfo.mobile||"未绑定",link:""},null,8,["onClick","rightText"]),g.userInfo.email?(i.openBlock(),i.createBlock(w,{key:0,class:"item",title:"电子邮箱",rightText:g.userInfo.email},null,8,["rightText"])):i.createCommentVNode("",!0),h.hasPwd?(i.openBlock(),i.createBlock(w,{key:1,class:"item",onClick:g.changePassword,title:"修改密码",link:""},null,8,["onClick"])):i.createCommentVNode("",!0)])),_:1}),i.createVNode(x,{class:"mt10"},{default:i.withCtx((()=>[i.createVNode(w,{onClick:g.deactivate,title:"注销账号",link:"navigateTo"},null,8,["onClick"])])),_:1}),i.createVNode(k,{ref:"dialog",type:"dialog"},{default:i.withCtx((()=>[i.createVNode(_,{mode:"input",value:g.userInfo.nickname,onConfirm:g.setNickname,inputType:h.setNicknameIng?"nickname":"text",title:"设置昵称",placeholder:"请输入要设置的昵称"},null,8,["value","onConfirm","inputType"])])),_:1},512),i.createVNode(v,{ref:"bind-mobile-by-sms",onSuccess:g.bindMobileSuccess},null,8,["onSuccess"]),h.showLoginManage?(i.openBlock(),i.createBlock(i.Fragment,{key:0},[g.userInfo._id?(i.openBlock(),i.createBlock(b,{key:0,onClick:g.logout},{default:i.withCtx((()=>[i.createTextVNode("退出登录")])),_:1},8,["onClick"])):(i.openBlock(),i.createBlock(b,{key:1,onClick:g.login},{default:i.withCtx((()=>[i.createTextVNode("去登录")])),_:1},8,["onClick"]))],64)):i.createCommentVNode("",!0)];t(l.ssrRenderComponent(f,{class:"avatar"},{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createVNode(y,{width:"260rpx",height:"260rpx"})];t(l.ssrRenderComponent(y,{width:"260rpx",height:"260rpx"},null,o,n))})),_:1},o,n)),t(l.ssrRenderComponent(x,null,{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createVNode(w,{class:"item",onClick:e=>g.setNickname(""),title:"昵称",rightText:g.userInfo.nickname||"未设置",link:""},null,8,["onClick","rightText"]),i.createVNode(w,{class:"item",onClick:g.bindMobile,title:"手机号",rightText:g.userInfo.mobile||"未绑定",link:""},null,8,["onClick","rightText"]),g.userInfo.email?(i.openBlock(),i.createBlock(w,{key:0,class:"item",title:"电子邮箱",rightText:g.userInfo.email},null,8,["rightText"])):i.createCommentVNode("",!0),h.hasPwd?(i.openBlock(),i.createBlock(w,{key:1,class:"item",onClick:g.changePassword,title:"修改密码",link:""},null,8,["onClick"])):i.createCommentVNode("",!0)];t(l.ssrRenderComponent(w,{class:"item",onClick:e=>g.setNickname(""),title:"昵称",rightText:g.userInfo.nickname||"未设置",link:""},null,o,n)),t(l.ssrRenderComponent(w,{class:"item",onClick:g.bindMobile,title:"手机号",rightText:g.userInfo.mobile||"未绑定",link:""},null,o,n)),g.userInfo.email?t(l.ssrRenderComponent(w,{class:"item",title:"电子邮箱",rightText:g.userInfo.email},null,o,n)):t("\x3c!----\x3e"),h.hasPwd?t(l.ssrRenderComponent(w,{class:"item",onClick:g.changePassword,title:"修改密码",link:""},null,o,n)):t("\x3c!----\x3e")})),_:1},o,n)),t(l.ssrRenderComponent(x,{class:"mt10"},{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createVNode(w,{onClick:g.deactivate,title:"注销账号",link:"navigateTo"},null,8,["onClick"])];t(l.ssrRenderComponent(w,{onClick:g.deactivate,title:"注销账号",link:"navigateTo"},null,o,n))})),_:1},o,n)),t(l.ssrRenderComponent(k,{ref:"dialog",type:"dialog"},{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createVNode(_,{mode:"input",value:g.userInfo.nickname,onConfirm:g.setNickname,inputType:h.setNicknameIng?"nickname":"text",title:"设置昵称",placeholder:"请输入要设置的昵称"},null,8,["value","onConfirm","inputType"])];t(l.ssrRenderComponent(_,{mode:"input",value:g.userInfo.nickname,onConfirm:g.setNickname,inputType:h.setNicknameIng?"nickname":"text",title:"设置昵称",placeholder:"请输入要设置的昵称"},null,o,n))})),_:1},o,n)),t(l.ssrRenderComponent(v,{ref:"bind-mobile-by-sms",onSuccess:g.bindMobileSuccess},null,o,n)),h.showLoginManage?(t("\x3c!--[--\x3e"),g.userInfo._id?t(l.ssrRenderComponent(b,{onClick:g.logout},{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createTextVNode("退出登录")];t("退出登录")})),_:1},o,n)):t(l.ssrRenderComponent(b,{onClick:g.login},{default:i.withCtx(((e,t,o,n)=>{if(!t)return[i.createTextVNode("去登录")];t("去登录")})),_:1},o,n)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e")})),_:1},s))}],["__scopeId","data-v-a98497c8"]]);exports.default=k;
