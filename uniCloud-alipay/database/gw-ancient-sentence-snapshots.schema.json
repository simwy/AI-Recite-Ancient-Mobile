{
  "bsonType": "object",
  "required": ["text_id", "split_version", "content_hash", "sentences"],
  "permission": {
    "read": true,
    "create": false,
    "update": false,
    "delete": false
  },
  "properties": {
    "_id": {
      "description": "ID"
    },
    "text_id": {
      "bsonType": "string",
      "description": "古文ID",
      "foreignKey": "gw-ancient-texts._id",
      "trim": "both"
    },
    "split_version": {
      "bsonType": "string",
      "description": "分句规则版本，如v1",
      "trim": "both"
    },
    "content_hash": {
      "bsonType": "string",
      "description": "原文哈希",
      "trim": "both"
    },
    "sentences": {
      "bsonType": "array",
      "description": "主句与播放子句快照（有序）",
      "items": {
        "bsonType": "object",
        "required": ["index", "sentence_id", "text"],
        "properties": {
          "index": {
            "bsonType": "int",
            "description": "主句顺序"
          },
          "sentence_id": {
            "bsonType": "string",
            "description": "主句ID",
            "trim": "both"
          },
          "text": {
            "bsonType": "string",
            "description": "主句文本"
          },
          "start_offset": {
            "bsonType": "int",
            "description": "主句在原文中的起始偏移",
            "defaultValue": 0
          },
          "end_offset": {
            "bsonType": "int",
            "description": "主句在原文中的结束偏移",
            "defaultValue": 0
          },
          "play_units": {
            "bsonType": "array",
            "description": "播放子句（用于长句拆分）",
            "items": {
              "bsonType": "object",
              "required": ["sub_index", "unit_id", "text"],
              "properties": {
                "sub_index": {
                  "bsonType": "int",
                  "description": "播放子句顺序"
                },
                "unit_id": {
                  "bsonType": "string",
                  "description": "播放子句ID",
                  "trim": "both"
                },
                "text": {
                  "bsonType": "string",
                  "description": "播放子句文本"
                }
              }
            }
          }
        }
      }
    },
    "created_at": {
      "bsonType": "timestamp",
      "description": "创建时间",
      "defaultValue": {
        "$env": "now"
      }
    },
    "updated_at": {
      "bsonType": "timestamp",
      "description": "更新时间",
      "defaultValue": {
        "$env": "now"
      }
    }
  }
}
